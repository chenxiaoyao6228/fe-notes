## å‰è¨€

æœ¬æ–‡æ¢³ç†äºŒè¿›åˆ¶ç›¸å…³çš„çŸ¥è¯†ç‚¹ã€‚

## è®¡ç®—æœºä¸­çš„æ•°æ®å­˜å‚¨

è®¡ç®—æœºåº•å±‚æ˜¯é€šè¿‡ 0 å’Œ 1 æ¥å‚¨å­˜æ•°æ®çš„ï¼Œå¯¹äºä¸åŒæ–‡ä»¶ï¼Œè®¡ç®—æœºä¼šä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼æ¥è¡¨ç¤ºã€‚
### æ•°å­—çš„è¡¨ç¤º

æ•´æ•°çš„è¡¨ç¤ºé€šå¸¸æ˜¯ç›´æ¥çš„äºŒè¿›åˆ¶å½¢å¼ã€‚ä¾‹å¦‚ï¼Œåè¿›åˆ¶æ•° 9 åœ¨äºŒè¿›åˆ¶ä¸­è¡¨ç¤ºä¸º 1001ã€‚

å¯¹äº[æµ®ç‚¹æ•°](https://en.wikipedia.org/wiki/Floating-point_arithmetic)ï¼Œè®¡ç®—æœºä½¿ç”¨ IEEE 754 æ ‡å‡†ï¼Œå°†æ•°å­—åˆ†æˆç¬¦å·ä½ã€æŒ‡æ•°å’Œå°¾æ•°ï¼Œä»¥ç§‘å­¦è®¡æ•°æ³•çš„å½¢å¼è¡¨ç¤ºã€‚æµ®ç‚¹æ•°çš„è®¡ç®—å¯èƒ½ä¼šå‡ºç°[è¯¯å·®](https://en.wikipedia.org/wiki/Floating-point_arithmetic#Accuracy_problems)

### æ–‡æœ¬çš„è¡¨ç¤º

æ–‡æœ¬é€šå¸¸ä½¿ç”¨å­—ç¬¦ç¼–ç æ ‡å‡†è½¬æ¢ä¸ºæ•°å­—ï¼Œç„¶åå†è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶ã€‚

ASCIIï¼ˆç¾å›½æ ‡å‡†ä¿¡æ¯äº¤æ¢ç ï¼‰æ˜¯æœ€æ—©çš„å­—ç¬¦ç¼–ç ï¼Œå°†æ¯ä¸ªå­—ç¬¦æ˜ å°„ä¸ºä¸€ä¸ªå”¯ä¸€çš„æ•°å­—ã€‚

[Unicode](https://developer.mozilla.org/en-US/docs/Glossary/Unicode)æ˜¯ä¸€ç§æ›´å¹¿æ³›çš„å­—ç¬¦ç¼–ç ï¼Œå®ƒåŒ…æ‹¬ä¸–ç•Œä¸Šå¤§éƒ¨åˆ†å­—ç¬¦çš„æ˜ å°„ã€‚

[UTF-8](https://en.wikipedia.org/wiki/UTF-8)æ˜¯ Unicode çš„ä¸€ç§å˜ä½“ï¼Œå®ƒä½¿ç”¨ä¸åŒé•¿åº¦çš„ç¼–ç è¡¨ç¤ºä¸åŒèŒƒå›´çš„å­—ç¬¦ã€‚

### å›¾åƒçš„è¡¨ç¤º

å›¾å½¢é€šå¸¸ç”±åƒç´ ç»„æˆã€‚æ¯ä¸ªåƒç´ éƒ½æœ‰é¢œè‰²ä¿¡æ¯ã€‚åœ¨è®¡ç®—æœºä¸­ï¼Œé¢œè‰²é€šå¸¸ç”±çº¢è‰²ï¼ˆRï¼‰ã€ç»¿è‰²ï¼ˆGï¼‰å’Œè“è‰²ï¼ˆBï¼‰çš„ç»„åˆæ¥è¡¨ç¤ºï¼Œè¿™å°±æ˜¯ RGB é¢œè‰²æ¨¡å¼ã€‚æ¯ä¸ªé¢œè‰²é€šé“å¯ä»¥ç”± 8 ä½ï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰è¡¨ç¤ºï¼Œè¿™å°±æ˜¯å¸¸è§çš„ 24 ä½é¢œè‰²è¡¨ç¤ºæ³•ã€‚å¯¹äºå›¾åƒæ–‡ä»¶ï¼Œåˆ™éœ€è¦é¢å¤–çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚å›¾åƒçš„å®½åº¦å’Œé«˜åº¦ã€‚

æˆ‘ä»¬å¯ä»¥å°† 1px\*1px çš„é»‘è‰²å›¾ç‰‡è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼Œç„¶åæŸ¥çœ‹å…¶äºŒè¿›åˆ¶æ•°æ®ã€‚

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/image-binary-representation.png)

- PNG æ–‡ä»¶ç­¾åï¼š å‰ 8 ä¸ªå­—èŠ‚ [137, 80, 78, 71, 13, 10, 26, 10] ä»£è¡¨ PNG æ–‡ä»¶ç­¾åã€‚
- PNG å¤´ä¿¡æ¯ï¼š æ¥ä¸‹æ¥çš„ 25 ä¸ªå­—èŠ‚ä»£è¡¨ PNG å¤´éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®½åº¦ã€é«˜åº¦ã€é¢œè‰²ç±»å‹å’Œå…¶ä»–å…ƒæ•°æ®ã€‚ä¾‹å¦‚ï¼Œ[0, 0, 0, 13] è¡¨ç¤º IHDR å—çš„é•¿åº¦ï¼Œ73, 72, 68, 82 è¡¨ç¤º ASCII å€¼ä¸º "IHDR"ï¼Œ[0, 0, 0, 1] å’Œ [0, 0, 0, 1] åˆ†åˆ«è¡¨ç¤ºå®½åº¦å’Œé«˜åº¦ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­éƒ½æ˜¯ 1 åƒç´ ï¼‰ã€‚
- å›¾åƒæ•°æ®ï¼š åç»­çš„å­—èŠ‚ä»£è¡¨å®é™…çš„åƒç´ æ•°æ®ã€‚
- æ–‡ä»¶ç»“æŸæ ‡å¿—ï¼š æœ€åçš„ 12 ä¸ªå­—èŠ‚ [73, 69, 78, 68, 174, 66, 96, 130] ä»£è¡¨ IEND å—ï¼Œè¡¨ç¤º PNG æ–‡ä»¶çš„ç»“æŸ

å®Œæ•´çš„ demo è¯·çœ‹ ğŸ‘‰ [åœ¨çº¿æ•ˆæœé¢„è§ˆ](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/Javascript/_demo/binary/data-representation.html), æŸ¥çœ‹ç¤ºä¾‹ä»£ç è¯·ç‚¹å‡»[æ­¤å¤„](https://github.com/chenxiaoyao6228/fe-notes/blob/main/Javascript/_demo/binary/data-representation.html)

è€Œå¯¹äºç›¸æœºæ‹æ‘„çš„ç…§ç‰‡ï¼Œå…¶äºŒè¿›åˆ¶æ•°æ®ä¼šæ›´åŠ å¤æ‚ï¼Œå› ä¸ºå…¶åŒ…å«äº†æ›´å¤šçš„å…ƒæ•°æ®ã€‚é€šå¸¸åŒ…æ‹¬æ‹æ‘„æ—¥æœŸã€ç›¸æœºå‹å·ã€æ›å…‰æ—¶é—´ã€å…‰åœˆã€ISO è®¾ç½®ç­‰ã€‚äº›å…ƒä¿¡æ¯éµå¾ªäº† EXIFï¼ˆExchangeable Image File Formatï¼‰æ ‡å‡†ï¼Œå¹¶ä¸”é€šå¸¸è¢«åµŒå…¥åœ¨å¸¸è§çš„å›¾åƒæ ¼å¼ï¼ˆå¦‚ JPEGï¼‰ä¸­ã€‚

è¿™äº›æ•°æ®çš„è§£æå¯ä»¥ç”¨[exif-js](https://github.com/exif-js/exif-js)åº“(æ¯”å¦‚åœ¨å¤„ç†ç§»åŠ¨ç«¯ç”¨æˆ·ç…§ç‰‡çš„æ—¶å€™ä¼šç”¨åˆ°).

```
  +-----------------------------------+
  |      å›¾ç‰‡çœŸå®æ•°æ®ï¼ˆåƒç´ ä¿¡æ¯ï¼‰          |
  +-----------------------------------+
  |   å›¾ç‰‡æ ¼å¼çš„å…ƒæ•°æ®ï¼ˆä¾‹å¦‚PNGçš„å¤´ä¿¡æ¯ï¼‰   |
  +-----------------------------------+
  |          é¢å¤–ä¿¡æ¯ï¼ˆEXIFç­‰ï¼‰          |
  +-----------------------------------+
```

ä¸‰è€…æœ‰ç‚¹ `IP->TCP->HTTP`å±‚å±‚å¥—åŒ…çš„æ„Ÿè§‰ã€‚

### è§†é¢‘çš„è¡¨ç¤º

è§†é¢‘: é€šå¸¸ç”±ä¸€ç³»åˆ—å¸§ç»„æˆã€‚æ¯ä¸€å¸§éƒ½æ˜¯é™æ­¢å›¾åƒï¼Œè¿™äº›å›¾åƒä»¥ä¸€å®šçš„é€Ÿç‡æ’­æ”¾ä»¥å‘ˆç°è¿ç»­çš„è¿åŠ¨ã€‚

è§†é¢‘çš„è¡¨ç¤ºæœ‰å…´è¶£å¯ä»¥åˆ°ç¤¾åŒºæŸ¥çœ‹ç›¸åº”çš„æ–‡ç« 

## Blob

Blobï¼ˆBinary Large Objectï¼‰

### Blob ä¸ base64 äº’è½¬

base64 è½¬ blob

```js
const base64ToBlob = (dataURI: string) => {
  const byteString = atob(dataURI.split(",")[1]);

  const mimeString = dataURI.split(",")[0].split(":")[1].split(";")[0];
  const ab = new ArrayBuffer(byteString.length);
  const ia = new Uint8Array(ab);
  for (let i = 0; i < byteString.length; i++) {
    ia[i] = byteString.charCodeAt(i);
  }
  return new Blob([ab], { type: mimeString });
};
```

## File

File ç»§æ‰¿ä¸ Blobï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡æŸ¥çœ‹ File çš„åŸå‹é“¾å¾—çŸ¥ã€‚

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/js-file-inheritance.png)

File å¯¹è±¡åŒæ—¶æ·»åŠ äº†ä¸€äº›å±æ€§å’Œæ–¹æ³•ï¼Œç”¨äºå¤„ç†æ–‡ä»¶ç›¸å…³æ“ä½œã€‚

```js
var myFile = new File(bits, name[, options]);
```

å…¶ä¸­ï¼Œ

- bits æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå¯ä»¥æ˜¯ ArrayBuffer å¯¹è±¡ã€ArrayBufferView å¯¹è±¡ï¼ˆæ¯”å¦‚ Uint8Array å¯¹è±¡ï¼‰æˆ–å­—ç¬¦ä¸²ã€‚
- name æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ–‡ä»¶åã€‚
- options æ˜¯å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ–‡ä»¶çš„ä¸€äº›å±æ€§ï¼Œç›®å‰åªæœ‰ lastModified å±æ€§ï¼Œè¿”å›ä¸€ä¸ªæ—¶é—´æˆ³ã€‚

è¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°† blob æ‰‹åŠ¨æ„é€ ä¸º file å¯¹è±¡

```js
const blobContent = "This is the content of the blob.";
const blob = new Blob([blobContent], { type: "text/plain" });
const fileName = "blob_file.txt";
const file = new File([blob], fileName, { type: "text/plain" });
console.log(file);
```
åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚å°†canvaså¯¼å‡ºçš„å›¾ç‰‡ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œéœ€è¦å°†canvas.toDataURL()çš„ç»“æœè½¬æ¢ä¸ºfileå¯¹è±¡ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ã€‚

ä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒFile å¯¹åº”å¯ä»¥ä» input[type=file]ä¸­è·å–åˆ°çš„æ–‡ä»¶å¯¹è±¡ã€‚

```js
const fileInput = document.getElementById("fileInput");
const file = fileInput.files[0];
```

ä¹Ÿå¯ä»¥ä» drag äº‹ä»¶ä¸­è·å–åˆ°çš„æ–‡ä»¶å¯¹è±¡ã€‚

```js
function handleDrop(event) {
  files = event.dataTransfer.files;
}
```

## ArrayBuffer/Buffer

ArrayBuffer æ˜¯Webç¯å¢ƒä¸‹å¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„åŸºç¡€å¯¹è±¡ï¼Œè€Œ Buffer æ˜¯Node.jsç¯å¢ƒä¸‹å¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„é«˜çº§å¯¹è±¡

ç›®å‰æš‚æ—¶æ²¡æœ‰å®è·µåœºæ™¯ï¼Œå…ˆç•™ä¸ªå‘ã€‚

## URL

åœ¨æ—¥å¸¸ä¸šåŠ¡ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¸¸ä½¿ç”¨ URL æ¥è§£æ urlï¼Œ

```
const url = new URL(
  "https://developer.mozilla.org/en-US/docs/Web/API/URL/pathname?q=value",
);
console.log(url.pathname); // Logs "/en-US/docs/Web/API/URL/pathname"
```

ä½†æ˜¯ URL æä¾›äº† createObjectURL(object)é™æ€æ–¹æ³•ï¼Œå¯ä»¥å°† **blob æˆ–è€… file å¯¹è±¡æˆ–è€… MediaSource å¯¹è±¡**è½¬æ¢ä¸º urlã€‚

```js
const selectedFile = imageInput.files[0];
URL.createObjectURL(selectedFile);
```

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/file-createObjectURL.png)

å®Œæ•´çš„ demo è¯·çœ‹ ğŸ‘‰ [åœ¨çº¿æ•ˆæœé¢„è§ˆ](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/Javascript/_demo/binary/url.html), æŸ¥çœ‹ç¤ºä¾‹ä»£ç è¯·ç‚¹å‡»[æ­¤å¤„](https://github.com/chenxiaoyao6228/fe-notes/blob/main/Javascript/_demo/binary/url.html)

### Canvas.toDataUrl å’Œ Canvas.toBlob

Canvas ä¸­æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å°† canvas è½¬æ¢ä¸º dataUrl æˆ–è€… blob å¯¹è±¡è¿›è¡Œå±•ç¤ºã€‚

```js
const canvas = document.getElementById("drawingCanvas");
const snapshotDataUrl = canvas.toDataURL();
snapshotImage.src = snapshotDataUrl;
snapshotImage.style.display = "block";
```

```js
const canvas = document.getElementById("drawingCanvas");
canvas.toBlob((blob) => {
  const snapshotDataUrl = URL.createObjectURL(blob);
  snapshotImage.src = snapshotDataUrl;
  snapshotImage.style.display = "block";
});
```

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/canvas-toDataUrl.png)

å®Œæ•´çš„ demo è¯·çœ‹ ğŸ‘‰ [åœ¨çº¿æ•ˆæœé¢„è§ˆ](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/Javascript/_demo/binary/canvas-toDataUrl.html), æŸ¥çœ‹ç¤ºä¾‹ä»£ç è¯·ç‚¹å‡»[æ­¤å¤„](https://github.com/chenxiaoyao6228/fe-notes/blob/main/Javascript/_demo/binary/canvas-toDataUrl.html)

## FormData ä¸ File ä¸æ–‡ä»¶ä¸Šä¼ 

å…ˆä¸¾ä¸€æ®µå¸¸è§„çš„æ–‡ä»¶ä¸Šä¼ çš„ä¾‹å­ï¼š
```js
const fileInput = document.getElementById('fileInput'); 
const file = fileInput.files[0]; 
formData.append('file', file, file.name); 
const  xhr = new XMLHttpRequest();


xhr.open('POST', '/upload', true);
xhr.onload = function() {
    // è¯·æ±‚å®Œæˆåçš„å¤„ç†é€»è¾‘
};
xhr.send(formData); // å°†FormDataå¯¹è±¡å‘é€åˆ°æœåŠ¡å™¨
```

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒFormData å¯¹è±¡ä¼šè´Ÿè´£å°† File å¯¹è±¡çš„æ•°æ®ä»¥ multipart/form-data æ ¼å¼ç»„ç»‡èµ·æ¥ï¼Œå¹¶å°†å…¶å‘é€åˆ°æœåŠ¡å™¨ã€‚

multipart/form-data æ˜¯ä¸€ç§ç”¨äºåœ¨ HTTP è¯·æ±‚ä¸­ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®çš„ä¸€ç§ç¼–ç æ–¹å¼ã€‚å®ƒå…è®¸ä½ åœ¨åŒä¸€ä¸ª HTTP è¯·æ±‚ä¸­ä¼ è¾“å¤šä¸ªæ•°æ®å—(parts),
æ¯ä¸ªæ•°æ®å—å¯ä»¥åŒ…å«æ–‡æœ¬æ•°æ®æˆ–äºŒè¿›åˆ¶æ•°æ®ï¼ˆä¾‹å¦‚æ–‡ä»¶ï¼‰ã€‚è¿™ç§ç¼–ç æ–¹å¼é€šå¸¸ç”¨äºå¤„ç†åŒ…å«æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„è¡¨å•ã€‚

```
POST /upload HTTP/1.1
Host: example.com
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="text_field"

Text data from a text field
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="example.txt"
Content-Type: text/plain

Contents of the file.
------WebKitFormBoundary7MA4YWxkTrZu0gW--
```

æœåŠ¡å™¨ç«¯çš„åº”ç”¨ç¨‹åºä¼šè§£æè¿™ä¸ªæ ¼å¼ï¼Œä»ä¸­æå–å‡ºæ–‡ä»¶æ•°æ®æˆ–å…¶ä»–è¡¨å•å­—æ®µçš„å€¼ï¼Œç„¶åè¿›è¡Œå¤„ç†ã€‚

## FileReader API

å¦‚æœçŸ¥é“ä¸€ä¸ªæ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®ç±»å‹ï¼Œä¹Ÿå¯ä»¥å°†è¿™ä¸ªæ–‡ä»¶è¯»å–ä¸º ArrayBuffer å¯¹è±¡ã€‚

```js
const fileInput = document.getElementById("fileInput");
const file = fileInput.files[0];
const reader = new FileReader();
reader.readAsArrayBuffer(file);
reader.onload = function () {
  const arrayBuffer = reader.result;
  // Â·Â·Â·
};
```

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/js-binary-jszip-file-async.png)

zip æ–‡ä»¶å¤„ç†åº“ jsZip çš„ jsZip.loadAsync æ–¹æ³•åº•å±‚å°±æ˜¯é€šè¿‡ FileReader æ¥è¯»å–æ–‡ä»¶çš„ã€‚

## å‚è€ƒ

- https://www.bbc.co.uk/bitesize/guides/zpfdwmn/revision/1
- https://wangdoc.com/javascript/bom/arraybuffer
- https://javascript.ruanyifeng.com/htmlapi/file.html
- https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL_static
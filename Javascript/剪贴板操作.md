## å‰è¨€

æœ¬æ–‡ä»‹ç»å‰ªè´´æ¿ç›¸å…³çš„ API ä»¥åŠå®ç°æ–‡æœ¬å¤„ç†æ•ˆæœ.

## Clipboard API

### 1. å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿

è¦å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ writeText()æ–¹æ³•ã€‚

```js
const copyToClipboard = async (text) => {
  try {
    await navigator.clipboard.writeText(text);
    console.log("å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š", text);
  } catch (err) {
    console.error("å¤åˆ¶å¤±è´¥ï¼š", err);
  }
};

// ä½¿ç”¨ç¤ºä¾‹
const textToCopy = "ä½ å¥½ï¼Œå‰ªè´´æ¿APIï¼";
copyToClipboard(textToCopy);
```

### 2. ä»å‰ªè´´æ¿ä¸­è¯»å–æ–‡æœ¬

è¦ä»å‰ªè´´æ¿ä¸­è¯»å–æ–‡æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨readText()æ–¹æ³•

```js
const readFromClipboard = async () => {
  try {
    const clipboardText = await navigator.clipboard.readText();
    console.log('ä»å‰ªè´´æ¿è¯»å–çš„å†…å®¹ï¼š', clipboardText);
  } catch (err) {
    console.error('è¯»å–å‰ªè´´æ¿å†…å®¹å¤±è´¥ï¼š', err);
  }
};

// ä½¿ç”¨ç¤ºä¾‹
readFromClipboard();
```


## å®é™…è¿ç”¨æ¡ˆä¾‹
### 1. å¤åˆ¶æ·»åŠ ç‰ˆæƒä¿¡æ¯

ğŸ‘‰ [åœ¨çº¿æ•ˆæœé¢„è§ˆ](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/Javascript/_demo/clipboard/add-copyright.html)

```js
function handleCopyEvent(event) {
  // è·å–é€‰ä¸­çš„æ–‡æœ¬
  const selection = window.getSelection();
  const selectedText = selection.toString();

  // æ·»åŠ ç‰ˆæƒæ–‡æœ¬
  const copyrightText = "\n\n@ç‰ˆæƒå½’é²è¿…æ‰€æœ‰";
  const modifiedText = selectedText + copyrightText;

  // ä½¿ç”¨Clipboard APIå¤åˆ¶ä¿®æ”¹åçš„æ–‡æœ¬
  event.clipboardData.setData("text/plain", modifiedText);

  // é˜»æ­¢é»˜è®¤çš„å¤åˆ¶æ“ä½œ
  event.preventDefault();
}

// ä¸ºæ–‡æ¡£æ·»åŠ å¤åˆ¶äº‹ä»¶ç›‘å¬å™¨
document.addEventListener("copy", handleCopyEvent);
```

###  2.ç™»å½•è¡¨å•å»é™¤ç©ºæ ¼ç¤ºä¾‹

ğŸ‘‰ [åœ¨çº¿æ•ˆæœé¢„è§ˆ](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/Javascript/_demo/clipboard/add-copyright.html)

```js
function handlePasteEvent(event) {
  // ä»å‰ªè´´æ¿è·å–ç²˜è´´çš„æ–‡æœ¬
  const pastedText = event.clipboardData.getData("text/plain");

  // å»é™¤ç²˜è´´çš„æ–‡æœ¬ä¸­çš„å‰å¯¼å’Œå°¾éšç©ºæ ¼
  const trimmedText = pastedText.trim();

  // é˜»æ­¢é»˜è®¤çš„ç²˜è´´è¡Œä¸º
  event.preventDefault();

  // åœ¨è¾“å…¥æ¡†ä¸­æ’å…¥å»é™¤ç©ºæ ¼åçš„æ–‡æœ¬
  const input = event.target;
  const startPosition = input.selectionStart;
  const endPosition = input.selectionEnd;
  const currentValue = input.value;
  const newValue =
    currentValue.slice(0, startPosition) +
    trimmedText +
    currentValue.slice(endPosition);
  input.value = newValue;

  // è®¾ç½®æ–°çš„å…‰æ ‡ä½ç½®ï¼Œä»¥ä¾¿ä¿æŒç„¦ç‚¹ä½ç½®
  const newSelectionPosition = startPosition + trimmedText.length;
  input.setSelectionRange(newSelectionPosition, newSelectionPosition);
}

// ä¸ºç”µå­é‚®ä»¶å’Œå¯†ç è¾“å…¥æ¡†æ·»åŠ ç²˜è´´äº‹ä»¶ç›‘å¬å™¨
const emailInput = document.getElementById("email");
emailInput.addEventListener("paste", handlePasteEvent);

const passwordInput = document.getElementById("password");
passwordInput.addEventListener("paste", handlePasteEvent);
```

## æ›´å¤š

- Clipboard è¿˜æ”¯æŒæ›´å¤šçš„ MIME type, è¿˜å¯ä»¥è‡ªå®šä¹‰ç±»å‹, åŠŸèƒ½å¾ˆå¼ºå¤§ã€‚
- åœ¨å¤„ç†å¯Œæ–‡æœ¬çš„å¤åˆ¶ç²˜è´´æ—¶ï¼Œç”±äºä¸åŒè½¯ä»¶ä¹‹é—´çš„è‡ªå®šä¹‰æ ¼å¼ï¼Œå¯¼è‡´éœ€è¦å¾ˆå¤šé¢å¤–çš„å·¥ä½œé‡å–åšå…¼å®¹

## å‚è€ƒ

- [Clibboard](https://developer.mozilla.org/zh-CN/docs/Web/API/Clipboard_API)
- [clipboardjs](https://clipboardjs.com/)
- [whatwg Rich Paste & DataTransfer / DataTransferItems API](https://lists.whatwg.org/pipermail/whatwg-whatwg.org/2011-March/030891.html)
- [Multi-MIME Type Copying with the Async Clipboard API](https://blog.tomayac.com/2020/03/20/multi-mime-type-copying-with-the-async-clipboard-api/)

---
permalink: 2023-02-04-antd踩坑汇总
title: antd踩坑汇总
date: 2023-02-04
categories:
  - tech
tags:
  - react
  - antd
---

## 状态注入

`antd`中的弹窗类组件使用了挂载到`body`的方式，脱离了原来的 App 组件的限制， 因此使用的时候需要额外注入一些上下文

```js
import { getLocale, IntlProvider } from "umi";

// 加载locales文件夹下的所有国际化文案
function loadLocales(context: any) {
  const localesMap = {};
  context.keys().forEach((key) => {
    const lang = key.match(/\.\/([a-zA-Z-]+)\.json$/)[1];
    localesMap[lang] = context(key);
  });
  return localesMap;
}
const context = require.context("../locales/", false, /\.json$/);
const localesMap = loadLocales(context);

/**
 * 本Hoc用于解决国际化文本不生效或报错
 * @param Component
 * @returns
 */
const MountIntl: <T>(Component: React.FC<T>, locale?: string) => React.FC<T> = (
  Component,
  locale = getLocale()
) => {
  return (props) => {
    return (
      <IntlProvider locale={locale} messages={localesMap[locale]}>
        <Component {...props}></Component>
      </IntlProvider>
    );
  };
};

export default MountIntl;
```

## å‰è¨€

æœ¬æ–‡æ¢è®¨ä¸‹å‰ç«¯å›½é™…åŒ– RTL é€‚é…ç›¸å…³çš„çŸ¥è¯†, å†…å®¹åŒ…æ‹¬:

- RTL é€‚é…éœ€è¦äº†è§£çš„èƒŒæ™¯çŸ¥è¯†
- å‰ç«¯ RTL é€‚é…æ–¹æ¡ˆ
- æ”¹é€ è¿‡ç¨‹ä¸­çš„ä¸€äº›è¸©å‘è®°å½•

## RTL é€‚é…åŸºç¡€

RTL æ˜¯ "Right-to-Left" çš„ç¼©å†™ï¼Œè¡¨ç¤ºä»å³åˆ°å·¦ã€‚å®ƒæ˜¯ä¸€ç§æ–‡æœ¬ä¹¦å†™å’Œå¸ƒå±€æ–¹å‘ï¼Œä¸ LTRï¼ˆ"Left-to-Right"ï¼Œä»å·¦åˆ°å³ï¼‰ç›¸å¯¹åº”ã€‚åœ¨ RTL çš„å¸ƒå±€ä¸­ï¼Œæ–‡æœ¬å’Œå…ƒç´ çš„æ–¹å‘æ˜¯ä»å³è¾¹å¼€å§‹ï¼Œé€æ¸å‘å·¦è¾¹å»¶ä¼¸ã€‚è¿™ç§æ–¹å‘é€šå¸¸ç”¨äºé˜¿æ‹‰ä¼¯è¯­ã€å¸Œä¼¯æ¥è¯­ã€æ³¢æ–¯è¯­ç­‰ä»å³å‘å·¦ä¹¦å†™çš„è¯­è¨€ã€‚

ä¸ºäº†æ›´åŠ ç›´è§‚åœ°äº†è§£ RTL é€‚é…ï¼Œè¿™é‡Œåˆ—ä¸¾ä¸€äº›ç½‘ç«™ä¾›å‚è€ƒ:

- Al Jazeera (æ–°é—») https://www.aljazeera.net/

- Asharq Al-Awsat (æ–°é—») https://aawsat.com/

- Souq (äºšé©¬é€Šä¸­ä¸œï¼Œç”µå•†) https://www.souq.com/sa-en/

- Emirates Airlines (èˆªç©º) https://www.emirates.com/

- Arabian Business (å•†ä¸š) https://www.arabianbusiness.com/

æ€»çš„æ¥è¯´ï¼Œéœ€è¦å¤„ç†ä¸‹åˆ—åœºæ™¯:

- æ–‡æœ¬æ–¹å‘ï¼š æ‰€æœ‰æ–‡æœ¬éƒ½éœ€è¦æ­£ç¡®åœ°ä»å³åˆ°å·¦æ’åˆ—ã€‚åŒ…æ‹¬æ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨å’ŒæŒ‰é’®ç­‰ã€‚ç¡®ä¿æ–‡æœ¬çš„è¯»å–æ–¹å‘ç¬¦åˆ RTL è¯­è¨€çš„ä¹ æƒ¯ã€‚

- å¸ƒå±€æ–¹å‘ï¼š æ•´ä½“å¸ƒå±€éœ€è¦è°ƒæ•´ï¼Œä»¥ç¡®ä¿é¡µé¢å…ƒç´ åœ¨ RTL æ–¹å‘ä¸‹æ­£ç¡®å¯¹é½ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°ç›’æ¨¡å‹ã€è¾¹è·ã€å¡«å……ä»¥åŠå…¶ä»–ä¸å¸ƒå±€ç›¸å…³çš„æ ·å¼ã€‚

- å¯¼èˆªèœå•ï¼š å¯¼èˆªèœå•çš„æ–¹å‘éœ€è¦ä»å·¦åˆ°å³å˜ä¸ºä»å³åˆ°å·¦ã€‚èœå•é¡¹çš„é¡ºåºå’Œå¯¹é½ä¹Ÿéœ€è¦ç›¸åº”è°ƒæ•´ã€‚

- è¡¨å•å…ƒç´ ï¼š è¡¨å•å…ƒç´ éœ€è¦æ­£ç¡®åœ°é€‚åº” RTL è¯­è¨€ï¼ŒåŒ…æ‹¬è¾“å…¥æ¡†ã€å¤é€‰æ¡†ã€å•é€‰æŒ‰é’®å’Œæäº¤æŒ‰é’®ç­‰ã€‚

- å›¾æ ‡å’Œå›¾åƒï¼š å›¾æ ‡å’Œå›¾åƒ**å¯èƒ½**éœ€è¦æ ¹æ®æ–‡æœ¬æ–¹å‘è¿›è¡Œç¿»è½¬ï¼Œä»¥ç¡®ä¿å®ƒä»¬åœ¨ RTL æ–¹å‘ä¸‹æ˜¾ç¤ºæ­£ç¡®ã€‚

- åŠ¨ç”»å’Œè¿‡æ¸¡ï¼š å¦‚æœæœ‰åŠ¨ç”»æˆ–è¿‡æ¸¡æ•ˆæœï¼Œéœ€è¦ç¡®ä¿å®ƒä»¬åœ¨ RTL æ–¹å‘ä¸‹è¡¨ç°è‡ªç„¶ä¸”ä¸ä¼šå¯¼è‡´æ··ä¹±ã€‚

é™¤äº†ä¸Šè¿°ï¼Œè¿˜æœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œæ¯”å¦‚å­—ä½“ï¼Œletter-spacing, æˆ‘ä»¬åœ¨è®¾è®¡ä¸å¼€å‘çš„æ—¶å€™ï¼Œå¯ä»¥å‚è€ƒä¸€äº›æ¯”è¾ƒæœ‰åçš„ guidelineï¼š

- [rtl-styling](https://rtlstyling.com/posts/rtl-styling)

- [material-ui bidirectionality](https://m2.material.io/design/usability/bidirectionality.html#mirroring-layout)

## æµè§ˆå™¨å¯¹ RTL çš„æ”¯æŒ

Web å¯¹ RTL çš„æ”¯æŒæ˜¯é€šè¿‡ HTML ä¸ CSS çš„å±æ€§æ¥å®ç°çš„

#### direction

dir ç”¨äºè®¾ç½®æ–‡æœ¬çš„ä¹¦å†™æ–¹å‘, dir å±æ€§æ˜¯ç»§æ‰¿çš„ï¼Œè¿™æ„å‘³ç€å¦‚æœä½ åœ¨çˆ¶å…ƒç´ ä¸Šè®¾ç½®äº† dir å±æ€§ï¼Œå­å…ƒç´ ä¼šç»§æ‰¿è¿™ä¸ªæ–¹å‘ã€‚è¿™ç§ç»§æ‰¿æ€§æ˜¯æŒ‰ç…§æ–‡æ¡£æµçš„æ–¹å‘æ¥åº”ç”¨çš„ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨æ–‡æ¡£çš„ `<html>` å…ƒç´ ä¸Šè®¾ç½®äº† dir="rtl"ï¼Œ**é‚£ä¹ˆæ•´ä¸ªæ–‡æ¡£å†…çš„å…ƒç´ ï¼Œé™¤éè¢«æ˜¾å¼è®¾ç½®äº†ä¸åŒçš„æ–¹å‘ï¼Œå¦åˆ™éƒ½ä¼šç»§æ‰¿è¿™ä¸ªå³åˆ°å·¦çš„æ–¹å‘**ã€‚è¿™åŒ…æ‹¬æ–‡æœ¬ã€å—çº§å…ƒç´ ã€å†…è”å…ƒç´ ç­‰ã€‚

å› æ­¤ä¸€èˆ¬è€Œè¨€ï¼Œåªéœ€è¦åœ¨æ ¹å…ƒç´  html è®¾ç½®ä¸€æ¬¡å³å¯ï¼Œ CSSWG ä¹Ÿå»ºè®®åœ¨ html æ ¹å…ƒç´ ä¸Šå®šä¹‰æ–¹å‘ï¼Œä»¥ç¡®ä¿åœ¨æ²¡æœ‰ CSS çš„æƒ…å†µä¸‹æ­£ç¡®çš„åŒå‘å¸ƒå±€ã€‚

```html
<html dir="rtl"></html>
```

#### direction çš„ä¸è¶³

é€šè¿‡æµ‹è¯•å¯ä»¥å‘ç° direction åªèƒ½æ”¹å˜ display: flex/inline-block å…ƒç´ çš„ä¹¦å†™æ–¹å‘ï¼Œå¯¹äº float/ç»å¯¹å®šä½ç­‰å¸ƒå±€å°±æ— èƒ½ä¸ºåŠ›

- [inline-block å¸ƒå±€](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/ä¸šåŠ¡ç›¸å…³/_demo/css-direction/direction-inline-block.html)

- [flex å¸ƒå±€](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/ä¸šåŠ¡ç›¸å…³/_demo/css-direction/direction-flex.html)

- [float å¸ƒå±€](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/ä¸šåŠ¡ç›¸å…³/_demo/css-direction/direction-float.html)

- [ç»å¯¹å®šä½å¸ƒå±€](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/ä¸šåŠ¡ç›¸å…³/_demo/css-direction/direction-positioned.html.html)

å¦å¤– direction æ— æ³•æ”¹å˜ margin, padding, border çš„æ°´å¹³æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯è¯´é™¤éä½ çš„å…ƒç´ æ˜¯å±…ä¸­çš„ï¼Œå¦åˆ™å½“ä½ çš„å…ƒç´ æ˜¯ä¸å¯¹ç§°çš„è¯ï¼Œå³ä½¿ä½ æ”¹å˜äº†å…ƒç´ çš„ä¹¦å†™æ–¹å‘å’Œé¡ºåºï¼Œmargin-left è¿˜æ˜¯æŒ‡å‘å·¦è¾¹çš„ï¼Œå®ƒå¹¶ä¸ä¼šç•™å‡ºå³è¾¹çš„ç©ºç™½ã€‚

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-css-direction-margin-padding-border.png)

å®Œæ•´çš„ demo è¯·çœ‹ ğŸ‘‰ [åœ¨çº¿æ•ˆæœé¢„è§ˆ](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/ä¸šåŠ¡ç›¸å…³/_demo/css-direction/direction-border-margin-padding.html)

#### css é€»è¾‘å±æ€§

é€»è¾‘å±æ€§æ˜¯ä¸€ç»„ç”¨äºå¤„ç†å¤šè¯­è¨€æ–‡æœ¬å¸ƒå±€çš„ CSS å±æ€§ï¼Œå®ƒä»¬è€ƒè™‘äº†æ–‡æœ¬ä¹¦å†™çš„é€»è¾‘æµï¼Œè€Œä¸ä»…ä»…æ˜¯ä¼ ç»Ÿçš„ä»å·¦åˆ°å³ï¼ˆLTRï¼‰æˆ–ä»å³åˆ°å·¦ï¼ˆRTLï¼‰çš„æ¦‚å¿µã€‚è¿™äº›å±æ€§å…è®¸å¼€å‘è€…ä»¥æ›´ç›´è§‚çš„æ–¹å¼æŒ‡å®šå¸ƒå±€ï¼Œè€Œä¸å—å…·ä½“ä¹¦å†™æ–¹å‘çš„é™åˆ¶ã€‚æ¯”å¦‚ä¸‹é¢ä¸€æ®µä»£ç :

```css
.box {
  width: 100px;
  height: 100px;
  background-color: lightblue;
  margin-inline-start: 20px; /* åœ¨LTRå¸ƒå±€ä¸­ä¸ºmargin-leftï¼Œåœ¨RTLå¸ƒå±€ä¸­ä¸ºmargin-right */
}
```

margin-inline-start å±æ€§åœ¨ LTR å¸ƒå±€ä¸­ä¸º margin-leftï¼Œåœ¨ RTL å¸ƒå±€ä¸­ä¸º margin-rightï¼Œè¿™æ ·å°±ä¸éœ€è¦åœ¨ LTR å’Œ RTL å¸ƒå±€ä¸­åˆ†åˆ«è®¾ç½® margin-left å’Œ margin-right äº†ã€‚

ä½†æ€»ä½“æ¥è¯´é€»è¾‘å±æ€§è¿˜æ˜¯æ¯”è¾ƒæ–°çš„ï¼Œå¯¹äº TO C äº§å“éœ€è¦è€ƒè™‘å¯¹åº”çš„å…¼å®¹æ€§é—®é¢˜ï¼Œæˆ–è€…ä½¿ç”¨[æ’ä»¶](https://www.npmjs.com/package/postcss-logical)è½¬åŒ–ä¸ºå®‰å…¨çš„ä¼ ç»Ÿçš„ CSS å±æ€§ã€‚

#### unicode-bidi

æµè§ˆå™¨é»˜è®¤æ ¹æ® HTML æ ¹å…ƒç´ ä¸Šçš„ dir å±æ€§è®¾ç½®æ–‡æœ¬æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯è¯´**å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬ä»…éœ€è¦åœ¨æ ¹å…ƒç´ ä¸Šè®¾ç½® dir å±æ€§å³å¯ã€‚ä½†æ˜¯å¦‚æœæ–‡æœ¬ä¸­æ··æœ‰å·¦->å³å’Œå³->å·¦çš„æ–‡å­—ï¼ˆå¦‚è‹±è¯­+é˜¿æ‹‰ä¼¯è¯­ï¼‰ï¼Œåˆ™å¼€å‘äººå‘˜éœ€è¦ä½¿ç”¨ unicode-bidi å±æ€§æ¥æ§åˆ¶æ–¹å‘**ã€‚

bidi æ˜¯"bidirectional"çš„ç¼©å†™ï¼Œè¡¨ç¤ºåŒå‘æ–‡å­—ï¼Œå³ä¸€æ®µæ–‡å­—åŒ…å«ä¸¤ç§ä¸åŒæ–¹å‘çš„æ–‡å­—ã€‚Unicode åŒå‘ç®—æ³•æ˜¯å¤„ç†è¿™ç§æ–‡å­—çš„å¸¸è§æ–¹æ³•ï¼Œè€Œ unicode-bidi å±æ€§ç”¨äºé‡å†™æ­¤ç®—æ³•ã€‚

[åœ¨çº¿æ•ˆæœé¢„è§ˆ](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/ä¸šåŠ¡ç›¸å…³/_demo/css-direction/unicode-bidi.html)

## å‰ç«¯ RTL é€‚é…æ–¹æ¡ˆ

### direction + æ‰‹åŠ¨å¤„ç†æ ·å¼æ–¹æ¡ˆ

ä» MDN çš„è¿™ä¸ª[è§†é¢‘](https://youtu.be/3qQeCPl3cjk)å¯ä»¥çœ‹åˆ°ï¼Œâ€è¿œå¤â€œæ—¶ä»£çš„å‰ç«¯æ˜¯å¦‚ä½•å¤„ç† RTL å¸ƒå±€çš„:

- é€šè¿‡åœ¨ html æ ¹å…ƒç´ ä¸Šè®¾ç½® dir å±æ€§
- å°†æ ·å¼è¡¨ä¸­çš„æœ‰æ–¹å‘ä¸æ— æ–¹å‘çš„çš„å±æ€§è¿›è¡Œåˆ†ç¦»
- æ‰‹åŠ¨å¤„ç†æœ‰æ–¹å‘çš„å±æ€§ï¼Œæ¯”å¦‚å°†`margin-left`è½¬æ¢ä¸º`margin-right`

ä½†æ˜¯æ˜¾è€Œæ˜“è§ï¼Œè¿™æ ·çš„æ–¹å¼è¿‡äºç¹çï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ï¼Œå› æ­¤åç»­å‡ºç°äº†ä¸€äº›è‡ªåŠ¨åŒ–çš„æ–¹æ¡ˆã€‚

### less/scss é¢„å¤„ç†è¯­è¨€æ··åˆæŒ‡ä»¤ç‰¹æ€§

é¦–å…ˆåˆ›å»ºä¸€ä¸ªåä¸º`rtl.less`çš„å…¬å…± mixin æŒ‡ä»¤æ–‡ä»¶

```less
.margin-left(@val: 0) {
  margin-left: @val;

  [dir="rtl"] & {
    margin-left: initial;
    margin-right: @val;
  }
}
```

ç„¶åï¼Œåœ¨æ ·å¼æ–‡ä»¶ä¸­å¼•å…¥è¯¥ mixin æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨`.margin-left`æ¥è°ƒç”¨ï¼š

```less
@import "path/to/rtl.less";

.el {
  border: 1px solid #000;
  .margin-left(10px);
}
```

æœ€ç»ˆç”Ÿæˆçš„æ ·å¼å¦‚ä¸‹ï¼š

```css
.el {
  border: 1px solid #000;
  margin-left: 10px;
}

[dir="rtl"] .el {
  margin-left: initial;
  margin-right: 10px;
}
```

### rtlcss ç­‰è‡ªåŠ¨åŒ–æ–¹æ¡ˆ

ä¸Šè¿°çš„ mixin æ–¹æ¡ˆè™½ç„¶æœ‰äº†å¾ˆå¤§çš„æå‡ï¼Œä½†ä»éœ€æ˜¾å¼å¤„ç†æ¯ä¸ªæœ‰æ–¹å‘å±æ€§ï¼Œå¢åŠ ç»´æŠ¤æˆæœ¬ã€‚å› æ­¤ï¼Œåç»­å‡ºç°äº†ä¸€äº›è‡ªåŠ¨åŒ–çš„æ–¹æ¡ˆï¼Œæ¯”å¦‚[rtlcss](https://rtlcss.com/index.html)

rtlcss æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„è‡ªåŠ¨åŒ– RTL è½¬æ¢å·¥å…·ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨è½¬æ¢ CSS æ ·å¼è¡¨ä¸­çš„å±æ€§ï¼Œæ¯”å¦‚å°†`margin-left`è½¬æ¢ä¸º`margin-right`ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨å¤„ç†ä¸€äº›è¾¹ç•Œæƒ…å†µï¼Œæ¯”å¦‚`border-radius`ã€`background-position`ç­‰ã€‚

ä¸‹åˆ—ä»£ç 

```css
.el {
  border: 1px solid #000;
  margin-left: 10px;
}
```

ç»è¿‡ä¸‹åˆ—å‘½ä»¤è½¬æ¢å

```bash
rtlcss styles.css styles-rtl.css
```

ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶ styles-rtl.cssï¼Œå…¶ä¸­åŒ…å«äº†è‡ªåŠ¨ç”Ÿæˆçš„ RTL æ ·å¼ã€‚

```css
.el {
  border: 1px solid #000;
  margin-left: auto;
  margin-right: 10px;
}
```

åœ¨ webpack é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨[postcss-rtlcss]()

å¦å¤–ï¼Œè¯¥æ–¹æ¡ˆæœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å¯¹é¡¹ç›®ä¸­çš„æ‰‹å†™ style æ— èƒ½ä¸ºåŠ›ï¼Œåªèƒ½å°½é‡ä¸è¦åœ¨é¡¹ç›®é‡Œé¢å†™ style

```js
const mySectionStyling = {flexDirection = i18n.dir === â€œltrâ€? â€œrowâ€ :â€œrow-reverseâ€}
```

### rtlcss + css é€»è¾‘å±æ€§æ–¹æ¡ˆ

å‰é¢æåˆ° css é€»è¾‘å±æ€§å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œä½†æ˜¯å¯¹åº”é¡¹ç›®ä¸éœ€è¦é€‚é…æ—§ç‰ˆæœ¬æµè§ˆå™¨çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è¯¥æ–¹æ¡ˆã€‚

æ—§ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸­å¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ `postcss-logical`æ’ä»¶æ¥å¤„ç†

### css in js æ–¹æ¡ˆ

å’Œ rtlcss ç±»ä¼¼ï¼Œcss in js æ–¹æ¡ˆä¹Ÿæ˜¯é€šè¿‡æ„å»ºå·¥å…·æ¥è‡ªåŠ¨å¤„ç†æ ·å¼ï¼Œå› ä¸ºé¡¹ç›®ä¸­æ²¡æœ‰ç”¨åˆ°ï¼Œæ‰€ä»¥ä¸åšè¿‡å¤šä»‹ç»ï¼Œæœ‰å…´è¶£å¯ä»¥å‚è€ƒ[airbnb çš„è¿™ä¸ªè§†é¢‘](https://www.youtube.com/watch?v=dZ9vQYSNVyo&ab_channel=ReactEurope)

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-css-in-js-airbnb.jpg)

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ                             | æè¿°                                                                                          | ä¼˜ç‚¹                                                                                          | ç¼ºç‚¹                                                                      |
| -------------------------------- | --------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------- |
| direction + æ‰‹åŠ¨å¤„ç†æ ·å¼æ–¹æ¡ˆ     | - åœ¨ html æ ¹å…ƒç´ ä¸Šè®¾ç½® dir å±æ€§<br/>- æ ·å¼è¡¨ä¸­æœ‰æ–¹å‘ä¸æ— æ–¹å‘å±æ€§åˆ†ç¦»<br/>- æ‰‹åŠ¨å¤„ç†æœ‰æ–¹å‘å±æ€§ | - å®Œå…¨å¯æ§ï¼Œæ‰‹åŠ¨å¤„ç†æ¯ä¸ªæœ‰æ–¹å‘å±æ€§<br/>- å¯ä»¥åœ¨ä¸ä½¿ç”¨æ„å»ºå·¥å…·çš„æƒ…å†µä¸‹å®ç°é€‚é…                 | - ç¹çï¼Œå®¹æ˜“å‡ºé”™<br/>- ç»´æŠ¤æˆæœ¬é«˜                                         |
| less/scss é¢„å¤„ç†è¯­è¨€æ··åˆæŒ‡ä»¤ç‰¹æ€§ | - åˆ›å»º mixin æ–‡ä»¶ï¼Œæ··å…¥ä½¿ç”¨<br/>- è‡ªåŠ¨ç”Ÿæˆ RTL æ ·å¼                                           | - å‡å°‘æ‰‹åŠ¨å¤„ç†ï¼Œæé«˜æ•ˆç‡<br/>- mixin å¯ä»¥é‡å¤ä½¿ç”¨                                             | - ä»éœ€æ˜¾å¼å¤„ç†æ¯ä¸ªæœ‰æ–¹å‘å±æ€§                                              |
| rtlcss ç­‰è‡ªåŠ¨åŒ–æ–¹æ¡ˆ              | - è‡ªåŠ¨è½¬æ¢ CSS æ ·å¼è¡¨ä¸­çš„å±æ€§ï¼Œå¦‚ margin-left åˆ° margin-right                                 | - è‡ªåŠ¨å¤„ç†æ ·å¼ï¼Œå‡å°‘æ‰‹åŠ¨æ“ä½œ<br/>- å¤„ç†ä¸€äº›è¾¹ç•Œæƒ…å†µï¼Œå¦‚ border-radiusã€background-position ç­‰ | - éœ€è¦æ„å»ºå·¥å…·æ”¯æŒï¼Œé…ç½®å¯èƒ½ç•¥å¤æ‚<br/>- éƒ¨åˆ†æƒ…å†µä¸‹éœ€è¦æ‰‹åŠ¨å¹²é¢„ç”Ÿæˆçš„æ ·å¼ |
| rtlcss + css é€»è¾‘å±æ€§æ–¹æ¡ˆ        | - ä½¿ç”¨ css é€»è¾‘å±æ€§ï¼Œå¦‚ margin-inline-start                                                   | - é€‚ç”¨äºç°ä»£æµè§ˆå™¨ï¼Œä¸éœ€è¦ç‰¹æ®Šæ„å»ºå·¥å…·                                                        | - å…¼å®¹æ€§é—®é¢˜ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ postcss-logical æ’ä»¶è¿›è¡Œå¤„ç†                   |
| css in js æ–¹æ¡ˆ                   | - é€šè¿‡æ„å»ºå·¥å…·è‡ªåŠ¨å¤„ç†æ ·å¼                                                                    | - å¯ä»¥ä½¿ç”¨ç°ä»£æ„å»ºå·¥å…·å®ç°è‡ªåŠ¨å¤„ç†<br/>- ä¸ React ç­‰æ¡†æ¶é›†æˆç´§å¯†                              | - éœ€è¦æ„å»ºå·¥å…·æ”¯æŒï¼Œå¯èƒ½éœ€è¦å­¦ä¹ æ–°çš„å·¥å…·å’Œæ–¹å¼                            |

ä¸Šè¿°å¯¹æ¯”ä¸‹æ¥ï¼Œè€ƒè™‘åˆ°é¡¹ç›®éœ€è¦åœ¨æ¯”è¾ƒè€çš„å®‰å“æœºä¸Šè·‘ï¼Œæˆå‘˜ä½¿ç”¨ css é€»è¾‘å˜é‡ç­‰è€ƒè™‘ï¼Œæœ€åé€‰å®šå•çº¯çš„ rtlcss æ–¹æ¡ˆï¼Œä¸‹é¢çš„å†…å®¹éƒ½æ˜¯åŸºäºè¯¥æ–¹æ¡ˆçš„ã€‚

## æ”¹é€ è¿‡ç¨‹è®°å½•

### åŸºæœ¬é€‚é…

ç¬¬ä¸€æ­¥æ ¹æ®ç”¨æˆ·è®¾ç½®çš„è¯­è¨€æ¥è®¾ç½® html æ ¹å…ƒç´ çš„ dir å±æ€§

```js
function setDocumentLangDir(lang: Language) {
  const rtlLangs = ["ar-EG"];

  document.documentElement.setAttribute("lang", lang);

  if (rtlLangs.includes(lang)) {
    document.documentElement.setAttribute("dir", "rtl");
  } else {
    document.documentElement.setAttribute("dir", "ltr");
  }
}
```

æ•ˆæœå¦‚ä¸‹, éƒ¨åˆ†é¡µé¢çš„é—´è·ä¼šæœ‰é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºæ˜¯éƒ¨åˆ† CSS å±æ€§æ²¡æœ‰æ­£ç¡®è®¾ç½®

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-html-dir.png)

æ·»åŠ `postcss-rtlcss`æ’ä»¶ï¼Œç”¨äºè‡ªåŠ¨è½¬æ¢ CSS å±æ€§ï¼Œæ¯”å¦‚å°†`margin-left`è½¬æ¢ä¸º`margin-right`

```js
const postcssRTLCSS = require('postcss-rtlcss');
const { Mode, Source, Autorename } = require('postcss-rtlcss/options');

// postcss loader
 {
    loader: require.resolve('postcss-loader'),
    options: {
      postcssOptions: {
        ident: 'postcss',
        config: false,
        plugins: [
          postcssRTLCSS({
            mode: Mode.combined,
          }),
        ],
      },
      sourceMap: isEnvProduction ? shouldUseSourceMap : isEnvDevelopment,
    },
}
```

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-postcss-rtl.jpg)

å¯ä»¥çœ‹åˆ°åœ¨å¯¹åº”çš„è¯­è¨€æ¨¡å¼ä¸‹è¿ç”¨äº†ä¸åŒçš„æ ·å¼è¡¨

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-postcss-rtl-stylesheet.png)

> ps: ä¸Šé¢ä¸¤æ­¥æå®Œå·²ç»å·®ä¸å¤šèƒ½å¤Ÿæ»¡è¶³ 80%çš„åœºæ™¯äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€äº›åœºæ™¯éœ€è¦é¢å¤–å¤„ç†

### éœ€è¦é¢å¤–å¤„ç†çš„åœºæ™¯

ä¸Šé¢æåˆ°ï¼Œé€šè¿‡åœ¨ html æ ¹å…ƒç´ ä¸Šè®¾ç½® dir å±æ€§ï¼Œå¯ä»¥å®ç°å¤§éƒ¨åˆ†åœºæ™¯çš„ RTL é€‚é…ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€äº›åœºæ™¯éœ€è¦é¢å¤–å¤„ç†ï¼Œæ¯”å¦‚:

#### åŠ¨æ€åˆ›å»ºå…ƒç´ 

ä¸€èˆ¬æ¥è¯´ï¼Œä¼šæ ¹æ® html ä¸Šçš„ dir å±æ€§æ¥è®¾ç½®è¾“å…¥æ¡†çš„æ–¹å‘ï¼Œä½†æ˜¯å¦‚æœæ˜¯åŠ¨æ€åˆ›å»ºçš„ input ç»„ä»¶ä¸”æ²¡æœ‰æ·»åŠ åˆ° body ä¸Šï¼Œ åˆ™éœ€è¦é¢å¤–çš„å¤„ç†, æ¯”å¦‚ä¸‹é¢ canvas ç™½æ¿ä½¿ç”¨äº†åŠ¨æ€åˆ›å»ºçš„ input ç»„ä»¶ï¼Œéœ€è¦é¢å¤–å¤„ç†

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-dynamic-input.gif)

ä¿®æ”¹çš„ä»£ç å¦‚ä¸‹:

```js
editable.dir = document.documentElement.dir;
```

#### åŠ¨ç”»å¤„ç†

éƒ¨åˆ†ç»„ä»¶æ¶‰åŠæ–¹å‘çš„åŠ¨ç”»éœ€è¦åšå¯¹åº”çš„é€‚é…ï¼Œæ¯”å¦‚ä¸‹é¢ Loading ç»„ä»¶çš„åŠ¨ç”»:

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-animation.gif)

è¯¥ç»„ä»¶çš„åŸå› æ˜¯ä½¿ç”¨äº† border ä½œä¸ºåŠ¨ç”»çš„è¾¹æ¡†ï¼Œå¹¶ä¸”éœ€è¦æ”¯æŒé¢œè‰²é…ç½®, å› æ­¤è‡ªåŠ¨çš„ postcss-rtl æ— æ³•è‡ªåŠ¨å¤„ç†ã€‚

```jsx
<div
  style={{
    borderRightColor: color,
    borderTopColor: color,
  }}></div>
```

è¿™æ—¶å€™éœ€è¦åŠ¨æ€æ ¹æ®æ–¹å‘æ¥è®¾ç½®å¯¹åº”çš„ borderï¼Œé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•æ ¹æ®æ–¹å‘æ¥åŠ¨æ€è®¾ç½®å¯¹åº”çš„ border å‘¢ï¼Ÿ

[è¿™é‡Œ](https://github.com/ant-design/ant-design/blob/master/components/config-provider/index.tsx)ä»¥åŠ[è¿™é‡Œ](https://github.com/rsuite/rsuite/blob/main/src/CustomProvider/CustomProvider.tsx)

å¯¹äº storybook ç»„ä»¶ï¼Œç”±äºæš‚æ—¶æ— æ³•ç›‘å¬ storybook-addon-rtl çš„æ–¹å‘å˜åŒ–ï¼Œæ‰€ä»¥åªèƒ½ç›‘å¬ html çš„ dir å˜åŒ–ï¼Œç„¶åå¼ºåˆ¶åˆ·æ–°

```tsx
// preview.tsx
const preview: Preview = {
  decorators: [
    (Story) => {
      const forceUpdate = useForceUpdate(); // æš‚æ—¶æ— æ³•ç›‘å¬storybook-addon-rtlçš„æ–¹å‘å˜åŒ–ï¼Œæ‰€ä»¥åªèƒ½ç›‘å¬htmlçš„dirå˜åŒ–ï¼Œç„¶åå¼ºåˆ¶åˆ·æ–°
      useHtmlDirAttributeObserver(forceUpdate);
      const direction = document.documentElement.getAttribute("dir") || "ltr";

      return (
        // @ts-ignore
        <ConfigProvider direction={direction}>
          <Story />
        </ConfigProvider>
      );
    },
  ],
};

const useHtmlDirAttributeObserver = (callback) => {
  const htmlElementRef = useRef(document.documentElement);

  useEffect(() => {
    const handleAttributeChange = (mutationsList) => {
      mutationsList.forEach((mutation) => {
        if (
          mutation.type === "attributes" &&
          mutation.attributeName === "dir"
        ) {
          const newDirValue = htmlElementRef.current.getAttribute("dir");
          callback(newDirValue);
        }
      });
    };

    const observer = new MutationObserver(handleAttributeChange);
    const config = { attributes: true };

    observer.observe(htmlElementRef.current, config);

    return () => {
      observer.disconnect();
    };
  }, [callback]);

  return htmlElementRef;
};

const useForceUpdate = () => {
  const [count, forceUpdate] = useState(0);
  return () => forceUpdate(() => count + 1);
};
```

åˆæ¯”å¦‚ä¸‹é¢çš„ Message ç»„ä»¶

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-message-component.gif)

å¯ä»¥çœ‹åˆ°ï¼ŒMessage ç»„ä»¶çš„åŠ¨ç”»æ˜¯ä»å·¦åˆ°å³çš„ï¼Œä½†æ˜¯åœ¨ RTL å¸ƒå±€ä¸‹ï¼Œéœ€è¦ä»å³åˆ°å·¦ï¼Œå› æ­¤éœ€è¦æ ¹æ®æ–¹å‘æ¥åŠ¨æ€è®¾ç½®åŠ¨ç”»çš„æ–¹å‘ã€‚

```less
[dir="rtl"] .@{prefixName}-message {
  &.@{prefixName}-msg-visible {
    animation: by-ui-visible-rtl 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0s 1 forwards;
  }

  &.@{prefixName}-msg-hidden {
    animation: by-ui-hidden-rtl 0.3s cubic-bezier(0.78, 0.14, 0.15, 0.86) 0s 1 forwards;
  }
}

// è¿™é‡Œæ·»åŠ äº†ä¸€ä¸ªæ–°çš„åŠ¨ç”»ï¼Œç”¨äºRTLå¸ƒå±€ä¸‹çš„åŠ¨ç”»
@keyframes by-ui-visible-rtl {
  from {
    opacity: 0;
    transform: translate(50%, -100%);
  }
  to {
    opacity: 1;
    transform: translateY(50%, 100%);
  }
}

@keyframes by-ui-hidden-rtl {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
    transform: translateY(50%, 100%);
  }
}
```

#### å›¾æ ‡&èƒŒæ™¯

æ¯”å¦‚ä¸‹é¢ä¸€ä¸ªåˆ†é¡µçš„é¡µç ï¼Œåœ¨ RTL å¸ƒå±€ä¸‹ï¼Œæ–‡å­—å’Œå›¾æ ‡éƒ½è¦è¿›è¡Œå¤„ç†

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-text-direction-before.png)

```css
// å¤„ç†æŒ‰é’®
[dir="rtl"] & {
  &:first-child,
  &:last-child {
    transform: scaleX(-1);
  }
}

// å¤„ç†æ–‡å­—
[dir="rtl"] & {
  unicode-bidi: bidi-override;
}
```

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-text-direction-after.gif)

å¯¹äºå›¾æ ‡çš„ç¿»è½¬ï¼Œæœ€å¥½æä¾›ä¸€ä¸ª mixin çš„æ–¹å¼ï¼Œæ–¹ä¾¿å¤ç”¨

```less
.flip-img {
  [dir="rtl"] & {
    transform: scaleX(-1);
  }
}
```

#### æ•°å­—ã€æ—¥æœŸå¤„ç†

ä½¿ç”¨å›½é™…åŒ–ç»„ä»¶çš„ API è¿›è¡Œå¤„ç†

#### js åŠ¨æ€ style

#### boundingClientRect

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒboundingClientRect çš„å€¼åœ¨ RTL å¸ƒå±€ä¸‹ä¾ç„¶æ˜¯ä»å·¦åˆ°å³çš„ï¼Œå› æ­¤éœ€è¦æ ¹æ®æ–¹å‘æ¥åŠ¨æ€è®¾ç½®

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-boundingClientRect.png)

```js
if (layout === "rtl") {
  target.style.right = ï¼ˆwindow.innerWidth - rect.rightï¼‰ + rect.width + gap + "px"; // æ³¨æ„è¿™é‡Œçš„è®¡ç®—æ–¹å¼æ˜¯é€šè¿‡window.innerWidth - rect.rightæ¥è®¡ç®—çš„
  // target.style.left = "auto";
} else {
  target.style.left = rect.left + rect.width + gap + "px";
  target.style.right = "auto";
}
```

å®Œæ•´çš„ demo è¯·çœ‹ ğŸ‘‰ [åœ¨çº¿æ•ˆæœé¢„è§ˆ](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/ä¸šåŠ¡ç›¸å…³/_demo/css-direction/boundingClientRect.html), æŸ¥çœ‹ç¤ºä¾‹ä»£ç è¯·ç‚¹å‡»[æ­¤å¤„](../_demo/css-direction/boundingClientRect.html)

#### ä¸‰æ–¹ä¾èµ–çš„å¤„ç†

##### å¦‚æœä¸‰æ–¹ç»„ä»¶ä¸æ”¯æŒ RTL

å¦‚æœä¸‰æ–¹ç»„ä»¶æš‚æ—¶ä¸æ”¯æŒ RTLï¼Œå¯ä»¥æš‚æ—¶åœ¨å®¹å™¨çš„æœ€å¤–å±‚å¼ºåˆ¶è®¾ç½®ä¸º LTR

```jsx
<div id="third-party-comp-wrapper" dir="ltr"></div>
```

##### google-drive

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-google-drive.png)

ä»£ç å¦‚ä¸‹ï¼š

```js
const instance = picker
  .setOAuthToken(token)
  .addView(view)
  .setLocale(getLang()) // é€šè¿‡è¿™é‡Œçš„setLocale API æ¥è®¾ç½®è¯­è¨€
  .addView(new google.picker.DocsUploadView())
  .setCallback(setCallback)
  .build();
```

#### å¿½ç•¥éƒ¨åˆ†æ ·å¼å¤„ç†

æœ‰æ—¶å€™éœ€è¦æ›´åŠ ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¿½ç•¥éƒ¨åˆ†æ ·å¼(ä¸€ç§æ¯”è¾ƒå¸¸è§çš„åœºæ™¯æ˜¯ç»å¯¹å®šä½ä¸­æœ‰ç»å¯¹å®šä½)

```less
.modal {
  position: absolute;
  top: 50%;
  /*rtl:ignore*/
  left: 50%;
  transform: translate(-50%, -50%);
}
```

### å…¶ä»–

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›é¢å¤–çš„åœºæ™¯éœ€è¦è€ƒè™‘

- æ–‡å­—æ’åº

é™äºç¯‡å¹…ï¼Œè¿™é‡Œä¸åšè¿‡å¤šä»‹ç»

### ä¸šåŠ¡ç»„ä»¶åº“å¤„ç†

æ·»åŠ [`storybook-addon-rtl`]()æ’ä»¶ï¼Œç”¨äºåˆ‡æ¢æ–¹å‘

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/rtl-storybook.gif)

ç”±äºæ— æ³•æ— æ³•ç›‘å¬åˆ°è¯¥æ’ä»¶çš„æ–¹å‘å˜åŒ–ï¼Œå› æ­¤åªèƒ½åœ¨ preview ä¸­ç›‘å¬ html çš„ dir å˜åŒ–ï¼Œç„¶åå¼ºåˆ¶åˆ·æ–° preview é¡µé¢

```tsx
// preview.tsx
const preview: Preview = {
  decorators: [
    (Story) => {
      const forceUpdate = useForceUpdate(); // æš‚æ—¶æ— æ³•ç›‘å¬storybook-addon-rtlçš„æ–¹å‘å˜åŒ–ï¼Œæ‰€ä»¥åªèƒ½ç›‘å¬htmlçš„dirå˜åŒ–ï¼Œç„¶åå¼ºåˆ¶åˆ·æ–°
      useHtmlDirAttributeObserver(forceUpdate);
      const direction = document.documentElement.getAttribute("dir") || "ltr";

      return (
        // @ts-ignore
        <ConfigProvider direction={direction}>
          <Story />
        </ConfigProvider>
      );
    },
  ],
};

const useHtmlDirAttributeObserver = (callback) => {
  const htmlElementRef = useRef(document.documentElement);

  useEffect(() => {
    const handleAttributeChange = (mutationsList) => {
      mutationsList.forEach((mutation) => {
        if (
          mutation.type === "attributes" &&
          mutation.attributeName === "dir"
        ) {
          const newDirValue = htmlElementRef.current.getAttribute("dir");
          callback(newDirValue);
        }
      });
    };

    const observer = new MutationObserver(handleAttributeChange);
    const config = { attributes: true };

    observer.observe(htmlElementRef.current, config);

    return () => {
      observer.disconnect();
    };
  }, [callback]);

  return htmlElementRef;
};

const useForceUpdate = () => {
  const [count, forceUpdate] = useState(0);
  return () => forceUpdate(() => count + 1);
};
```

åŒæ—¶é¡¹ç›®ä¸­ï¼Œåº”è¯¥æä¾›å¯¹åº”çš„ context, åœ¨ dir å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œé€šçŸ¥ç»„ä»¶è¿›è¡Œæ›´æ–°ï¼Œä¸€èˆ¬ç»„ä»¶åº“éƒ½ä¼šæä¾›ä¸€ä¸ª contextProvider å¤„ç†è¿™ä¸ªé€»è¾‘ï¼Œå‚è€ƒä»£ç å¦‚ä¸‹ï¼š

```tsx
import React, { useMemo, createContext } from "react";

export interface IConfigProviderProps {
  direction?: "rtl" | "ltr";
  children?: React.ReactNode;
}

export const ConfigProviderContext = createContext<IConfigProviderProps>({});

export const ConfigProvider: React.FC<IConfigProviderProps> = (props) => {
  const { direction = "ltr", children, ...restProps } = props;

  const config = useMemo(
    () => ({
      direction,
      ...restProps,
    }),
    [direction, restProps]
  );

  return (
    <ConfigProviderContext.Provider value={config}>
      {children}
    </ConfigProviderContext.Provider>
  );
};
```

ä¸šåŠ¡ä¸­çš„ä½¿ç”¨

```tsx
 <ConfigProvider direction="rtl">
       {children}
        </StyleProvider>
      </ConfigProvider>
```

æ›´åŠ å¤æ‚çš„ä¾‹å­è¯·å‚è€ƒ

- antd, [ç”¨æ³•](https://ant.design/components/config-provider-cn#config-provider-demo-direction), [æºç ](https://github.com/ant-design/ant-design/blob/master/components/config-provider/index.tsx)

- rsuite, [ç”¨æ³•](https://github.com/rsuite/rsuite/blob/main/src/CustomProvider/CustomProvider.tsx#L52), [æºç ](https://github.com/rsuite/rsuite/blob/main/src/CustomProvider/CustomProvider.tsx#L52)

#### Dropdown ä¸‹æ‹‰é€‰é¡¹æ¡†çš„å¤„ç†

å¯¹äº placement çš„å¤„ç†ï¼Œä¸€æ—¦æ¶‰åŠåˆ°æ–¹å‘`left`å’Œ`right`ï¼Œå°±éœ€è¦æ ¹æ®æ–¹å‘æ¥åŠ¨æ€è®¾ç½®ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç 

```tsx
<Dropdown
  placement={direction === "rtl" ? "bottomRight" : "bottomLeft"}
  align={{ offset: direction === "rtl" ? [179, 45] : [-179, 45] }}></Dropdown>
```

## ä¸€äº›æ”¹è¿›é¡¹ && TODO

1. ç›®å‰æ— æ³•é€šè¿‡ postcss-rtl æ’ä»¶è‡ªåŠ¨å¤„ç†é€‚é…ï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ  eslint è§„åˆ™åŠ ä»¥è§„èŒƒ
2. babel æ’ä»¶å¯¹å†…è” JSX è‡ªåŠ¨åŒ–å¤„ç†
3. æ ·å¼åŠ¨æ€åŠ è½½(æ¯”å¦‚åª’ä½“æŸ¥è¯¢)
4. å°†ä¸Šè¿°æ–¹æ¡ˆæ•´åˆä¸ºä¸€ä¸ªå¤§çš„ pluginï¼Œæ–¹ä¾¿å¤ç”¨åˆ°å…¶ä»–é¡¹ç›®ä¸­

## å‚è€ƒ

- https://m2.material.io/design/usability/bidirectionality.html#mirroring-layout

- https://note.youdao.com/ynoteshare/index.html?id=9ae40d5b5c2a7f55c50b11e68a9f8da4&type=note

- https://rtlstyling.com/posts/rtl-styling

- https://github.com/MohammadYounes/rtlcss

- https://github.com/elchininet/postcss-rtlcss

- https://juejin.cn/post/6989055383486758919

- https://bootstrap.rtlcss.com/docs/4.1/components/forms/#custom-forms

- https://www.youtube.com/watch?v=dZ9vQYSNVyo&ab_channel=ReactEurope

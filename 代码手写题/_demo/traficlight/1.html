<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        margin: 10px;
      }
      .btn {
        height: 40px;
        padding: 0 20px;
        margin-bottom: 20px;
      }

      .traffic-light {
        border: 1px solid #333;
        display: inline-block;
      }
      .light {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin: 10px;
        border: 1px solid #ccc;
      }
    </style>
  </head>
  <body>
    <div class="traffic-light">
      <div class="light red"></div>
      <div class="light green"></div>
      <div class="light yellow"></div>
    </div>

    <script>
      function renderLight(color) {
        const lights = document.querySelectorAll(".light");
        lights.forEach(
          (light) => (light.style.backgroundColor = "transparent")
        );
        document.querySelector(`.${color}`).style.backgroundColor = color;
      }

      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      async function renderLightWidthDelay(color, duration) {
        renderLight(color);
        await sleep(duration);
      }

      const lightRunner = (() => {
        const tasks = [];
        let curIndex = 0;

        const add = (task) => {
          tasks.push(task);
        };

        const run = async () => {
          while (tasks.length) {
            const task = tasks[curIndex];
            await task();
            if (curIndex >= tasks.length - 1) {
              curIndex = 0;
            } else {
              curIndex++;
            }
          }
        };

        return {
          add,
          run,
        };
      })();

      lightRunner.add(() => renderLightWidthDelay("red", 1000));
      lightRunner.add(() => renderLightWidthDelay("green", 1000));
      lightRunner.add(() => renderLightWidthDelay("yellow", 1000));
      lightRunner.run();
    </script>
  </body>
</html>

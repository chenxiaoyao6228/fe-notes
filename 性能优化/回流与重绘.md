## å‰è¨€

æœ¬æ–‡æ€»ç»“å›æµä¸é‡ç»˜ç›¸å…³çš„çŸ¥è¯†ç‚¹

## å›æµä¸é‡ç»˜çš„åŸºæœ¬æ¦‚å¿µ

é‡ç»˜ï¼ˆRepaintï¼‰ï¼š å½“å…ƒç´ æ ·å¼å‘ç”Ÿæ”¹å˜ï¼Œä½†ä¸å½±å“å…¶å‡ ä½•å±æ€§çš„æ—¶å€™ï¼Œæµè§ˆå™¨åªéœ€è¦é‡æ–°ç»˜åˆ¶è¿™ä¸ªå…ƒç´ ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºé‡ç»˜ã€‚

å›æµï¼ˆReflowï¼‰ï¼š å½“é¡µé¢å¸ƒå±€å’Œå‡ ä½•å±æ€§å‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´éƒ¨åˆ†æˆ–å…¨éƒ¨å…ƒç´ çš„å°ºå¯¸ã€ä½ç½®ã€ç»“æ„å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—å…ƒç´ çš„å‡ ä½•å±æ€§å’Œé¡µé¢çš„å¸ƒå±€ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºå›æµã€‚

> é‡ç»˜ä¸ä¸€å®šä¼šè§¦å‘å›æµï¼Œå›æµä¸€å®šä¼šè§¦å‘é‡ç»˜ã€‚

## è§¦å‘æ¡ä»¶

å›æµå’Œé‡ç»˜çš„è§¦å‘æ¡ä»¶ä¸»è¦åŒ…æ‹¬å¯¹ DOM ç»“æ„å’Œæ ·å¼çš„ä¿®æ”¹ã€‚ä»¥ä¸‹æ˜¯è§¦å‘å›æµå’Œé‡ç»˜çš„å¸¸è§æ“ä½œï¼š

### å›æµçš„è§¦å‘æ¡ä»¶ï¼š

- åˆå§‹åŒ–é¡µé¢ã€‚
- æ”¹å˜çª—å£å¤§å°ã€‚
- æ·»åŠ ã€åˆ é™¤ã€æ›´æ–° DOM å…ƒç´ ã€‚
- æ”¹å˜å…ƒç´ çš„ä½ç½®ã€å°ºå¯¸ã€å†…å®¹ã€‚
- ä¿®æ”¹å…ƒç´ çš„ fontã€paddingã€margin ç­‰æ ·å¼å±æ€§ã€‚

å¯¹äºå›æµä¸é‡ç»˜ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°é€šè¿‡ chrome çš„å¼€å‘è€…å·¥å…·æ¥æŸ¥çœ‹ï¼š

æ¯”å¦‚ä¸‹é¢çš„ js æ“ä½œ

```js
document.querySelector(".box").addEventListener("click", function () {
  // æ”¹å˜å…ƒç´ å°ºå¯¸
  this.style.width = "200px";
});
```

é€šè¿‡ chrome æ§åˆ¶é¢æ¿å¯ä»¥çœ‹åˆ°ï¼š

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/repaint-screenshot-1.png)

å®Œæ•´çš„ demo è¯·çœ‹ğŸ‘‰ [åœ¨çº¿æ•ˆæœé¢„è§ˆ](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/æ€§èƒ½ä¼˜åŒ–/_demo/reflow-repaint/change-resize.html), æŸ¥çœ‹ç¤ºä¾‹ä»£ç è¯·ç‚¹å‡»[æ­¤å¤„](https://github.com/chenxiaoyao6228/fe-notes/blob/main/æ€§èƒ½ä¼˜åŒ–/_demo/reflow-repaint/change-resize.html)

> ç½‘ä¸Šæœ‰è¯´æ³•ï¼š è·å– offsetTopã€offsetLeftã€offsetWidthã€offsetHeightã€scrollTopã€scrollLeftã€scrollWidth.
> scrollHeightã€clientTopã€clientLeftã€clientWidthã€clientHeight ä»¥åŠè°ƒç”¨ getComputedStyle ç­‰å±æ€§å’Œæ–¹æ³•éƒ½ä¼šè§¦å‘å›æµã€‚
> ä½†æ˜¯ä» chrome æ§åˆ¶é¢æ¿ä¸­çœ‹åˆ°è¿™äº›ç°è±¡å¹¶ä¸ä¼šè§¦å‘å›æµï¼Œæ‰€ä»¥è¿™äº›è¯´æ³•æœ‰å¾…å•†æ¦·ã€‚

### é‡ç»˜çš„è§¦å‘æ¡ä»¶ï¼š

- ä¿®æ”¹å…ƒç´ çš„é¢œè‰²ã€èƒŒæ™¯è‰²ã€‚
- ä¿®æ”¹å…ƒç´ çš„ visibilityã€outlineã€box-shadow ç­‰ä¸å½±å“å¸ƒå±€çš„å±æ€§ã€‚

æ¯”å¦‚ä¸‹é¢çš„ js æ“ä½œ

```js
document.querySelector(".box").addEventListener("click", function () {
  // ä¿®æ”¹å…ƒç´ é¢œè‰²
  this.style.backgroundColor = "red";
});
```

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/repaint-screenshot-2.png)

å®Œæ•´çš„ demo è¯·çœ‹ğŸ‘‰ [åœ¨çº¿æ•ˆæœé¢„è§ˆ](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/æ€§èƒ½ä¼˜åŒ–/_demo/reflow-repaint/change-color.html), æŸ¥çœ‹ç¤ºä¾‹ä»£ç è¯·ç‚¹å‡»[æ­¤å¤„](https://github.com/chenxiaoyao6228/fe-notes/blob/main/æ€§èƒ½ä¼˜åŒ–/_demo/reflow-repaint/change-color.html)

ä»”ç»†ä¸ä¸Šå›¾å¯¹æ¯”æˆ‘ä»¬å¯ä»¥å‘ç°å°‘äº†**Layout** è¿™ä¸€æ­¥ï¼Œè¯´æ˜åªè§¦å‘äº†é‡ç»˜ï¼Œæ²¡æœ‰è§¦å‘å›æµã€‚

## ä¼˜åŒ–ç­–ç•¥ä¸æœ€ä½³å®è·µ

### åˆå¹¶å¤šæ¬¡ä¿®æ”¹

åˆå¹¶å¤šæ¬¡ DOM å’Œæ ·å¼ä¿®æ”¹çš„ä¼˜åŠ¿ï¼Œå‡å°‘å›æµå’Œé‡ç»˜çš„æ¬¡æ•°ã€‚

```js
// ä¸ä¼˜åŒ–çš„å†™æ³•ï¼Œä¼šè§¦å‘å¤šæ¬¡å›æµå’Œé‡ç»˜
element.style.width = "100px";
element.style.height = "100px";
element.style.backgroundColor = "red";

// ä¼˜åŒ–çš„å†™æ³•ï¼Œåˆå¹¶ä¸ºä¸€æ¬¡å›æµå’Œé‡ç»˜
element.style.cssText = "width: 100px; height: 100px; background-color: red;";
```

### ä½¿ç”¨ class æ“ä½œ

é€šè¿‡ä¿®æ”¹å…ƒç´ çš„ç±»è€Œä¸æ˜¯ç›´æ¥æ“ä½œæ ·å¼ï¼Œå¯ä»¥åˆ©ç”¨æµè§ˆå™¨å¯¹ç±»çš„å¤„ç†è¿›è¡Œä¼˜åŒ–ã€‚è¿™æ ·å¯ä»¥å‡å°‘ç›´æ¥æ ·å¼ä¿®æ”¹å¯¼è‡´çš„å›æµå’Œé‡ç»˜ã€‚

```js
// ä¸ä¼˜åŒ–çš„å†™æ³•ï¼Œä¼šè§¦å‘å›æµå’Œé‡ç»˜
element.style.width = "100px";
element.style.height = "100px";
element.style.backgroundColor = "red";

// ä¼˜åŒ–çš„å†™æ³•ï¼Œé€šè¿‡ä¿®æ”¹ç±»åå®ç°
element.classList.add("custom-style");
```

```css
/* CSSä¸­å®šä¹‰æ ·å¼ */
.custom-style {
  width: 100px;
  height: 100px;
  background-color: red;
}
```

### ç¦»çº¿æ“ä½œ

æ‰§è¡Œç¦»çº¿ DOM æ“ä½œï¼Œå³åœ¨ä¿®æ”¹å¤§é‡ DOM å…ƒç´ ä¹‹å‰ï¼Œå…ˆå°†å®ƒä»¬ä»æ–‡æ¡£ä¸­ç§»é™¤ï¼Œè¿›è¡Œæ“ä½œåå†æ”¾å›æ–‡æ¡£ã€‚è¿™æ ·å¯ä»¥æœ€å°åŒ–å¯¹é¡µé¢æ¸²æŸ“çš„ç›´æ¥å½±å“ï¼Œé™ä½å›æµå’Œé‡ç»˜çš„æ¬¡æ•°ã€‚

```js
// ä¸ä¼˜åŒ–çš„å†™æ³•ï¼Œä¼šè§¦å‘å¤šæ¬¡å›æµå’Œé‡ç»˜
for (let i = 0; i < 100; i++) {
  document.body.appendChild(document.createElement("div"));
}

// ä¼˜åŒ–çš„å†™æ³•ï¼Œç¦»çº¿æ“ä½œ
const fragment = document.createDocumentFragment();
for (let i = 0; i < 100; i++) {
  const div = document.createElement("div");
  fragment.appendChild(div);
}
document.body.appendChild(fragment);
```

## æµè§ˆå™¨ä¸­çš„ Flush é˜Ÿåˆ—

åœ¨æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“ä¸­ï¼Œå½“å‘ç”Ÿ DOM æˆ–æ ·å¼å˜åŒ–æ—¶ï¼Œå¼•æ“å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œç›¸åº”çš„å›æµå’Œé‡ç»˜æ“ä½œã€‚ç›¸åï¼Œå®ƒå°†è¿™äº›æ“ä½œæ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªé˜Ÿåˆ—è¢«ç§°ä¸º **Flush é˜Ÿåˆ—**ã€‚

å…·ä½“çš„åˆå¹¶æœºåˆ¶å¯ä»¥å½’ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š

- æ‰¹é‡æ‰§è¡Œ: æµè§ˆå™¨ä¼šç­‰å¾…ä¸€å®šæ—¶é—´ï¼Œæ”¶é›†å¤šä¸ªå›æµå’Œé‡ç»˜ä»»åŠ¡ï¼Œç„¶åä¸€æ¬¡æ€§æ‰§è¡Œå®ƒä»¬ã€‚è¿™æ ·å¯ä»¥å‡å°‘ä»»åŠ¡çš„åˆ‡æ¢å¼€é”€ï¼Œå¹¶ä¼˜åŒ–æ€§èƒ½ã€‚
- ç­–ç•¥æ€§åˆå¹¶: æµè§ˆå™¨ä¼šæ ¹æ®ä¸€äº›ç­–ç•¥æ€§çš„è€ƒè™‘ï¼Œå°†ä¸€äº›ç›¸å…³è”çš„å›æµå’Œé‡ç»˜ä»»åŠ¡åˆå¹¶åœ¨ä¸€èµ·ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ªå…ƒç´ çš„å¤šä¸ªæ ·å¼åŒæ—¶å‘ç”Ÿå˜åŒ–ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šå°†å®ƒä»¬åˆå¹¶æˆä¸€ä¸ªæ“ä½œï¼Œä»¥å‡å°‘å›æµå’Œé‡ç»˜çš„æ¬¡æ•°ã€‚
- å¼‚æ­¥æ‰§è¡Œï¼š éƒ¨åˆ†å›æµå’Œé‡ç»˜ä»»åŠ¡å¯èƒ½ä¼šè¢«æ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰ä¸­æ‰§è¡Œã€‚è¿™æ„å‘³ç€åœ¨å½“å‰äº‹ä»¶å¾ªç¯ä¸­å‘ç”Ÿçš„å¤šä¸ª DOM å’Œæ ·å¼å˜åŒ–å¯èƒ½ä¼šåœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­è¢«åˆå¹¶æ‰§è¡Œï¼Œä»è€Œå‡å°‘äº†å½“å‰äº‹ä»¶å¾ªç¯ä¸­çš„ä»»åŠ¡æ‰§è¡Œå¼€é”€ã€‚

ä»¥ä¸‹é¢ä¸€æ®µ js ä»£ç ä¸ºä¾‹

```js
const box = document.querySelector(".box");

box.addEventListener("click", () => {
  // å¤šæ¬¡ä¿®æ”¹æ ·å¼ï¼Œåˆå¹¶ä¸ºä¸€æ¬¡å›æµå’Œé‡ç»˜
  function performMultipleChanges() {
    box.style.width = "200px";
    box.style.height = "200px";
    box.style.backgroundColor = "red";
  }

  // è°ƒç”¨å¤šæ¬¡ä¿®æ”¹ï¼Œè§‚å¯Ÿåˆå¹¶æ•ˆæœ
  performMultipleChanges();
  performMultipleChanges();
  performMultipleChanges();
});
```

æ‰§è¡Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°chromeå¯¹ä¸Šè¿°çš„å¤šä¸ªstyleå˜æ›´ä»¥åŠå¤šæ¬¡çš„performMultipleChangeså‡½æ•°è°ƒç”¨è¿›è¡Œäº†åˆå¹¶ï¼Œæœ€ç»ˆåªè§¦å‘äº†ä¸€æ¬¡å›æµå’Œé‡ç»˜ã€‚

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/repaint-screenshot-3.png)


å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æµè§ˆå™¨éƒ½åšäº†è¿™äº›ä¼˜åŒ–çš„æ“ä½œï¼Œå› æ­¤ä½œä¸ºå¼€å‘è€…ï¼Œè¿˜æ˜¯è¦æé«˜è‡ªå·±çš„çŸ¥è¯†å‚¨å¤‡ï¼Œå°½é‡é¿å…ä¸å¿…è¦çš„å›æµå’Œé‡ç»˜ã€‚



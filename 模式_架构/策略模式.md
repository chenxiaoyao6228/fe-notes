## ç­–ç•¥æ¨¡å¼

ç­–ç•¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ç®—æ³•çš„å®ç°ä¸ä½¿ç”¨åˆ†ç¦»å¼€æ¥ã€‚åœ¨ç­–ç•¥æ¨¡å¼ä¸­ï¼Œç®—æ³•è¢«å°è£…æˆç‹¬ç«‹çš„ç­–ç•¥ç±»ï¼Œè€Œä½¿ç”¨è¿™äº›ç­–ç•¥çš„ç±»åˆ™é€šè¿‡ç»„åˆå…³ç³»æ¥ä½¿ç”¨è¿™äº›ç­–ç•¥ã€‚è¿™ä½¿å¾—ç®—æ³•å¯ä»¥ç‹¬ç«‹äºå…¶ä½¿ç”¨è€…è€Œå˜åŒ–ï¼Œä»è€Œæé«˜äº†ä»£ç çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ç­–ç•¥æ¨¡å¼ä¸è¡¨å•æ ¡éªŒ

### ä»£ç å®ç°

```js
const { curry, isFunction } = _;
function formValidator(strategies = {}) {
  const validators = [];

  function getVaildator() {
    // å‡½æ•°æŸ¯é‡ŒåŒ–
    return curry(async function (vaildator, errMessage, value) {
      const pass = await vaildator(value);
      if (!pass) {
        return errMessage;
      } else {
        return null;
      }
    });
  }

  function add(check, errMessage) {
    let checkFun = null;

    if (!check || (!isFunction(check) && !strategies[check])) {
      console.error(
        `ä¸å­˜åœ¨åä¸º ${check} çš„æ ¡éªŒé¡¹ï¼Œè¯·æ£€æŸ¥å‡½æ•°formValidatorçš„å‚æ•°`
      );
      return false;
    }

    checkFun = isFunction(check) ? check : strategies[check];

    validators.push(getVaildator()(checkFun, errMessage || ""));
  }

  async function check(value) {
    for (let i = 0; i < validators.length; i++) {
      const validator = validators[i];
      const error = await validator(value);
      if (error) return error;
    }
    return null;
  }

  return {
    add,
    check,
  };
}
```

ä½¿ç”¨

```js
// è‡ªå®šä¹‰æ ¡éªŒç­–ç•¥---é‚®ç®±
const emailFormatReg = /^[\w\.-]+@[\w\.-]+(\.[\w\.-]+)+$/;
const emailSpecialSymbolReg = /^[a-zA-Z0-9_@.-]+$/;
const emailFormStrategies = {
  checkEmpty: (value) => !!value,
  checkFormat: (value) => emailFormatReg.test(value),
  checkHasSpecialSymbol: (value) => emailSpecialSymbolReg.test(value),
};
// è‡ªå®šä¹‰æ ¡éªŒç­–ç•¥---å¯†ç 
const pwdFormatReg =
  /^((?![(~!@#\$%^&\\*()\+\-=,\./;|<>\?)]+$)(?![\d]+$)(?![a-zA-Z]+$)[\d(~!@#\$%^&\\*()\+\-=,\./;|<>\?)a-zA-Z]+)$/;

const pwdSpecialSymbolReg = /^[a-zA-Z\d(~!@#\$%^&\\*()\+\-=,\./;|<>\?)]+$/;

const passwordStrategies = {
  checkEmpty: (value) => !!value,
  checkNotEqual: (equalValue, value) => value !== equalValue,
  checkEqual: (equalValue, value) => equalValue === value,
  checkLength: (value) => value.length >= 8 && value.length <= 16,
  checkFormat: (value) => pwdFormatReg.test(value),
  checkHasSpecialSymbol: (value) => pwdSpecialSymbolReg.test(value),
};

// -------------- å®ä¾‹åŒ–å¹¶ä½¿ç”¨ --------------

const emailValidator = formValidator(emailFormStrategies);

emailValidator.add("checkEmpty", "é‚®ç®±ä¸èƒ½ä¸ºç©º");
emailValidator.add("checkFormat", "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®");
emailValidator.add("checkHasSpecialSymbol", "é‚®ç®±ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦");

const passwordValidator = formValidator(passwordStrategies);

passwordValidator.add("checkEmpty", "å¯†ç ä¸èƒ½ä¸ºç©º");
passwordValidator.add("checkNotEqual", "å¯†ç ä¸èƒ½å’Œé‚®ç®±ç›¸åŒ", "email");
passwordValidator.add("checkLength", "å¯†ç é•¿åº¦å¿…é¡»ä¸º8-16ä½");
passwordValidator.add("checkFormat", "å¯†ç å¿…é¡»åŒ…å«å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦");
```

### æ•ˆæœ

![](https://cdn.jsdelivr.net/gh/chenxiaoyao6228/cloudimg@main/2023/design-pattern-strategy.gif)

å®Œæ•´çš„ demo è¯·çœ‹ ğŸ‘‰ [åœ¨çº¿æ•ˆæœé¢„è§ˆ](https://chenxiaoyao6228.github.io/html-preview/?https://github.com/chenxiaoyao6228/fe-notes/blob/main/æ¨¡å¼_æ¶æ„/_demo/strategy-pattern/index.html), æŸ¥çœ‹ç¤ºä¾‹ä»£ç è¯·ç‚¹å‡»[æ­¤å¤„](./_demo/strategy-pattern/index.html)

## 前言

> [原文: level-up-your-reverse-engineering-skills](https://indepth.dev/posts/1005/level-up-your-reverse-engineering-skills), 作者：Max Koretskyi

> 所有我无法[重新]创造的东西，我对它也就谈不上真正的理解。

上面的引语来自理查德·费曼，他是我们这个时代最伟大的科学家和物理学家之一。他的意思是，从一张空白的纸和他已经掌握的知识开始，他可以重新推导出任何理论结果。**费曼认为这种能力是真正理解某些东西的标志**。

我坚信自己需要了解基本原理。牢固掌握常见问题的已有解决方案，对于找到新问题解决方案是绝对必要的。你必须知道如何解决你所从事领域中已经解决的每个问题。 然而这里有一个挑战——你在哪里找到这种知识？在我们现在生活的快节奏世界中，技术作者几乎没有时间编写提供基本见解的文档。那么答案是什么呢？**我主张进行反向工程**。

我以对 Angular 进行逆向工程而闻名。但 Angular 并不是我深入研究过的唯一框架。我探索了 Vue.js、Webpack、jQuery 和许多其他网络库和框架。我现在正在经历 React。而且，我相信我已经获得足够的见解来与你分享并帮助你开始进行逆向工程。

对我来说，逆向工程的过程是发现新事物的魔法。这是对新发现感到兴奋并像黑客一样思考的状态：永远保持好奇。我希望本指南能帮助你的思想达到相同的状态。

我将我的发现分为两篇文章。本文概述了我在进行逆向工程时使用的准则和原则。**第二篇文章通过对 React 的一小部分进行逆向工程的实际过程展示了这些原则的实际应用**。它还演示了一些有趣的调试技术，以加速你的逆向工程工作。但首先，让我们从为什么要进行逆向工程开始。

## 缘起

让我们面对现实，逆向工程是一项艰苦的工作。这很耗时并且通常需要大量的知识库。既然如此那又何必劳神费力呢？

大多数人认为逆向工程的主要目标是增强对技术的了解，以找到更好的工作。由于现代技术的寿命很短，因此花时间深入研究是没有意义的。

通过阅读源代码，你几乎肯定会对任何技术有很好的理解。但是，这只是通过逆向工程获得的众多好处之一。

当你浏览源代码时，你将熟悉新的设计模式以解决常见问题，然后可以在工作中重复使用。我亲身体验过很多次。例如，当我逆向工程 Angular 的路由时，我学会了如何延迟加载组件和模块，这有助于我构建基于插件的平台。

你将学习语言的许多新功能。当我对 Angular 进行逆向工程时，我了解了 JavaScript 中的单态性。你将学习底层平台的 API，因为大多数技术都大量使用它。你会发现新的东西来学习并看到它们的实际用法，而不仅仅是在书中阅读它并猜测你可以在哪里使用它。

如果你决定与社区分享你的发现，这将有助于建立你的公众形象。这是一种双赢的局面，因为通过帮助他人，你也在帮助自己。我的成功故事始于[Angular-In-Depth（AiD）](https://medium.com/angular-in-depth)，当我决定开始写关于我的发现时。从那时起，AiD 已成为最大的 Angular 出版物，并显着帮助我开始在会议上演讲，并在 ag-Grid 找到完美的工作。通过花时间学习一项技术并深入了解，你也在展示你的解决问题的能力，决心和好奇心。这些是创新公司在候选人中寻找的素质。

你还将适应阅读现有代码和探索新的代码库。Robert C. Martin，俗称鲍勃叔叔，**估计阅读与写作的时间之比远远超过 10：1**。我们不断阅读旧代码，作为编写新代码的一部分，这是所有开发人员在开始处理现有项目时的起点。通过练习逆向工程，你将获得这种(快速熟悉代码的)优势。

**如你所见，逆向工程将使你成为更好的工程师。**

## 帮助逆向工程所需的知识

让我们首先看一下一些可以使得反向工程过程更容易和更快的事情。(你需要)花时间学习和掌握它们。需要了解的内容很多，很可能你现在并没有这些知识。但不用担心，每天留出一两个小时进行有意识的学习，并设定成为这些领域的专家的目标，你会成功的。

### 扎实的底层平台知识

成功进行逆向工程的第一个要求是了解底层平台 API。如果我们谈论运行在 Web 上的框架和库，以下是你需要掌握的内容：JavaScript、DOM API 和浏览器 API。

对 JavaScript 有扎实的理解并不意味着你知道什么是闭包或如何解决`this`的指向问题。扎实的理解意味着你必须知道大多数高级的东西，如属性描述符（由 Vue.js 使用，代理对象或位掩码（由 Angular 使用）。

在谈论 DOM 和浏览器 API 时，知道如何创建和追加 DOM 节点或异步执行回调是不够的。你需要知道如果重新附加现有子节点会发生什么，或者浏览器如何处理未知元素。了解用于发出 HTTP 请求的现有 API 及其复杂性，例如何时执行 XHR 失败回调。

为了掌握 JavaScript，我推荐[Axel Rauschmayer](http://exploringjs.com/?source)的书。为了掌握 DOM 和浏览器 API，我推荐 [MDN 文档](https://developer.mozilla.org/en-US)和 [Google 开发者文档](https://developers.google.com/web/updates) 。而且，如果你能学会阅读规范，那当然是理想的来源：[JavaScript 的 EcmaScript](https://www.ecma-international.org/ecma-262/5.1/) 和浏览器环境的 [WHATWG](https://spec.whatwg.org/)

## 调试工具

深入了解你最喜欢的浏览器的开发者工具是至关重要的。我最喜欢的浏览器是 Chrome。因此在 Chrome 中，你应该知道：

- 在控制台中键入 $0 时的含义
- 如何使用条件断点
- 如何在异常之前暂停
- 如何跳过部分代码或跳出当前函数
- 如何在加载的源等中找到特定文本

关于 Chrome Dev Tools 最好的资源当然是[Google 的 Web 开发人员工具]()

## 常见的设计模式和通用的架构概念

有时技术中会使用常见的设计模式。因此了解它们是有益的。例如，Webpack 依赖于异步库实现的异步 JS 执行模式。ES 模块之前的所有框架和库都使用 UMD 打包格式进行分发。随着你探索越来越多的框架和库，你将开始识别常见的模式，这将帮助你更快地浏览代码。

## 与特定技术相关的概念

如果你了解框架或库使用的概念，这也会有所帮助。例如，在对现代框架进行逆向工程之前，你应该知道组件是什么。有时你可以从文档中获取这些概念，有时则可以从深入的文章或设计文档中获取。在开始探索代码之前，阅读所有你能找到的东西。在代码中发现新概念时阅读它们。我建议阅读具有具体实现细节的材料，而不是针对一般读者的明显简化的变体。会议演讲通常不是了解具体细节的最佳方式。 Github 上的设计文档和高级文章更有帮助。

## 探索源码的准则

阅读后续文章以了解我如何使用这些指南来阅读 React 源码。我建议你记下你在前进过程中发现的知识点。之后你将能够将它们拼凑在一起并看到更大的图景。

## 确定要关注的技术部分

我被问到的最常见的问题是从哪里开始，将 debugger 语句放在代码库中的什么位置。好吧，你可以从你的目标中弄清楚这一点。在开始逆向工程之前，你应该始终了解想要了解技术的哪一部分。例如，在对 Angular 或 React 进行逆向工程时，我首先想了解变化检测。这是我需要关注的框架的一部分。由于我对现代更改检测过程的了解，我知道更改检测是将更改从组件实例同步到 DOM 节点。所以我需要找到这些框架存储对创建的 DOM 节点的引用的位置,这就是目标。

## 像科学家一样思考

我认为**观察->基于观察提出假设->实验验证**的科学方法是最有效的知识获取方法。这也是我在逆向工程时使用的模型。以下是基本步骤：

- 进行观察并形成假设。
- 根据假设进行预测。
- 测试预测。

获得结果后，使用它们来做出新的假设和预测。持续迭代直到你弄清楚你关注的部分。

使用推理来形成假设并做出预测。推理是使用观察和背景来得出合乎逻辑的结论。例如，如果你看到某人吃一种新食物，他或她做了一个鬼脸，那么你就会推断他不喜欢它。或者，如果有人关上门，你可以推断她对某事感到不安。

除了给你一个结构化的逆向工程方法之外，我相信假设（假设）和验证会在你的记忆中创建锚点，帮助你更长时间地保留你学到的东西，并在需要时检索它们。

## 在调试、探索源代码中的实现和阅读注释之间切换

逆向工程不仅仅是阅读源代码。事实上，我只花大约 20% 的时间检查源代码中的特定实现细节。我花了大约 70% 的时间调试示例应用程序。这就是为什么我认为掌握良好的调试工具对于使逆向工程过程高效是必不可少的。剩下的 10% 的时间我花在阅读源代码中的注释或代码中发现的概念的解释上。通常评论比你在网上找到的任何东西都更有帮助，所以永远不要忽视它们。

## 使用调用堆栈构造应用程序流

在继续调试并将断点放在代码中的不同位置时，请定期检查调用堆栈。查看函数调用的顺序将使你了解应用程序流。通常它还将帮助你在源码中找到具有相关功能的功能。

## 不要因为错误的假设而气馁

准备接受你的大部分假设都被证明是错误的，这是一个正常且意料之中的过程。有时这意味着你应该花更多的时间来建立你的背景知识。但通常它只是意味着框架或库实现的模式是新颖的。

这并不是说你不会感到沮丧。但是请密切关注奖品，克服这些挫折并继续前进，在犯错中不断学习新的东西。

## 给自己一些时间思考你的发现

芭芭拉·奥克利（Barbara Oakley）在《数字思维》（Mind for Numbers）一书中谈到了两种交替的思维状态——专注模式和扩散模式。这两种方法对于学习新事物都是必不可少的。聚焦模式涉及使用理性、顺序和分析方法解决问题的直接方法。漫反射模式使我们能够突然对我们一直在努力解决的问题获得新的见解，并与“大局”观点相关联。漫反射模式是当你放松注意力并让你的思绪徘徊时发生的事情。因此，不要只是在电脑前坐上几个小时，定期短暂休息并思考您的发现。我只是在我的公寓里走来走去。当我做任何创造性的工作时，我都会这样做，比如写作，而不仅仅是逆向工程。

## 从获取源码和设置示例应用程序开始

要对框架或库进行逆向工程，你将需要其源码和具有该技术的示例应用程序。如今大多数框架和库都托管在 Github 上，只管克隆仓库即可。如果你希望探索特定版本，因此请转到代码仓库中的“release”选项卡并检查最新版本。一旦您克隆了仓库，请通过运行 `git checkout tags/[version].`切换此版本。

第二步是设置示例应用程序。始终尝试将最简单的设置放在一起。避免使用现代框架提供的 webpack 和 CLI 工具等代码打包器。根据我的经验，它们使调试体验大大复杂化。理想的设置是一个纯 HTML 页面，其中包含从 CDN 加载的代码，例如 unpkg.com。只需确保框架或库的版本与源代码中的版本匹配即可。

## 关于运气

与生活中的一切一样，运气起着重要作用。当你重复使用相同的功能部分时，你可能会偶然发现一个新的注释，它会使某个概念变得清晰；或具有你之前没有注意到的描述性名称的函数调用，这种事经常发生在我身上。所以我建议你用 debugger 多次调试你不理解的代码段。或者稍后再回来，不要因为你现在不明白就完全放弃它。下次你浏览它时很有可能会发现一些新的东西，因为你已经获得了一些新的见解。准备好见证这一切了吗？

请阅读[逆向工程指南和原则的实际应用](https://indepth.dev/posts/1006/practical-application-of-reverse-engineering-guidelines-and-principles)
